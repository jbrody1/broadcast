/*! Crocodoc Viewer - v0.3.0 | (c) 2014 Box */
Crocodoc=function(){"use strict";function a(c,d,e){var f;for(e=e||c,f=0;f<d.length;++f){if(c===d[f])throw new Error("Circular dependency detected: "+e+"->"+d[f]);b[d[f]]&&a(c,b[d[f]].mixins,e+"->"+d[f])}}var b={},c={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",modules:b,services:c,createViewer:function(a,b){var c=new Crocodoc.Scope(this),d=c.createModuleInstance("viewer-api");return d.init(a,b),d},addModule:function(c,d,e){d instanceof Function&&(e=d,d=[]),a(c,d),b[c]={mixins:d,creator:e}},createModuleInstance:function(a,c){var d=b[a];if(d){for(var e=[],f=0;f<d.mixins.length;++f)e.push(this.createModuleInstance(d.mixins[f],c));return e.unshift(c),d.creator.apply(d.creator,e)}return null},addService:function(a,b){c[a]={creator:b,instance:null}},getService:function(a){var b=c[a];return b?(b.instance||(b.instance=b.creator(this)),b.instance):null}}}();Crocodoc.Scope=function(){"use strict";return function(a){var b=a.getService("util"),c=[];this.createModuleInstance=function(b){var d=a.createModuleInstance(b,this);return d&&(d.moduleName=b,c.push(d)),d},this.removeModuleInstance=function(a){var b,d;for(b=0,d=c.length;d>b;++b)if(a===c[b]){"function"==typeof a.destroy&&a.destroy(),c.splice(b,1);break}},this.destroy=function(){var a,b,d;for(a=0,b=c.length;b>a;++a)d=c[a],"function"==typeof d.destroy&&d.destroy();c=[]},this.broadcast=function(a,d){var e,f,g,h;for(e=0,f=c.length;f>e;++e)g=c[e],g&&(h=g.messages||[],-1!==b.inArray(a,h)&&"function"==typeof g.onmessage&&g.onmessage.call(g,a,d))},this.getService=function(b){return a.getService(b)}}}(),function(){"use strict";Crocodoc.EventTarget=function(){this._handlers={}},Crocodoc.EventTarget.prototype={constructor:Crocodoc.EventTarget,on:function(a,b){"undefined"==typeof this._handlers[a]&&(this._handlers[a]=[]),this._handlers[a].push(b)},fire:function(a,b){var c,d,e,f={type:a,data:b};if(c=this._handlers[f.type],c instanceof Array)for(d=0,e=c.length;e>d;d++)c[d]&&c[d].call(this,f);if(c=this._handlers.all,c instanceof Array)for(d=0,e=c.length;e>d;d++)c[d]&&c[d].call(this,f)},off:function(a,b){var c,d,e=this._handlers[a];if(e instanceof Array){if(!b)return e.length=0,void 0;for(c=0,d=e.length;d>c;c++)if(e[c]===b||e[c].handler===b){e.splice(c,1);break}}},one:function(a,b){var c=this,d=function(e){c.off(a,d),b.call(c,e)};d.handler=b,this.on(a,d)}}}(),Crocodoc.Viewer=function(){"use strict";return{defaults:{url:null,layout:Crocodoc.LAYOUT_VERTICAL,zoom:Crocodoc.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null}}}(),Crocodoc.addService("browser",function(){"use strict";var a,b,c,d,e,f,g=navigator.userAgent,h={};return a=/iphone|ipod|ipad/i.test(g),b=/android/i.test(g),d=/webos/i.test(g),c=/blackberry/i.test(g),e=/blackberry/i.test(g),f=/MSIE/i.test(g),f&&(h.ie=!0,h.version=parseFloat(/MSIE\s+(\d+\.\d+)/i.exec(g)[1]),h.ielt9=h.version<9,h.ielt10=h.version<10),a&&(h.ios=!0),h.mobile=/mobile/i.test(g)||a||b||c||d||e,h.firefox=/firefox/i.test(g),/safari/i.test(g)&&(h.chrome=/chrome/i.test(g),h.safari=!h.chrome),h}),Crocodoc.addService("subpx",function(a){"use strict";function b(){if(!$.support.leadingWhitespace)return!1;var a=$(e.template(d,{size:12.5})).appendTo(document.documentElement).get(0),b=$(a).css("font-size"),c=$(a).width();$(a).remove(),a=$(e.template(d,{size:12.6})).appendTo(document.documentElement).get(0);var f=$(a).css("font-size"),g=$(a).width();if($(a).remove(),!("ontouchstart"in window)){if(b===f)return!1;if(c===g)return!1}return!0}var c="crocodoc-subpx-fix",d='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",e=a.getService("util"),f=b();return{fix:function(a){if(!f&&void 0!==document.body.style.zoom){var b=$("<div>").addClass(c);$(a).children().wrapAll(b)}return a},isSubpxSupported:function(){return f}}}),Crocodoc.addService("support",function(){"use strict";function a(a){var c,d,f,g=document.createElement("div");if(a in g.style)return a;if(c=a.charAt(0).toUpperCase()+a.substr(1),a in g.style)return a;for(d=0;d<e.length;++d)if(f=e[d]+c,f in g.style)return 0===f.indexOf("ms")&&(f="-"+f),b(f);return!1}function b(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}var c,d,e=["Moz","Webkit","O","ms"];return function(){for(var a=0,b=["ms","moz","webkit","o"],e=0;e<b.length&&!c;++e)c=window[b[e]+"RequestAnimationFrame"],d=window[b[e]+"CancelAnimationFrame"]||window[b[e]+"CancelRequestAnimationFrame"];c||(c=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),d||(d=function(a){clearTimeout(a)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:a("transform"),csstransition:a("transition"),csszoom:a("zoom"),requestAnimationFrame:function(){return c.apply(window,arguments)},cancelAnimationFrame:function(){d.apply(window,arguments)}}}),Crocodoc.addService("util",function(){"use strict";var a={};return a.extend=$.extend,a.each=$.each,a.map=$.map,$.extend(a,{bisectLeft:function(a,b,c){var d=0,e=a.length;if(c)for(;e>d&&a[d][c]<b;)d++;else for(;e>d&&a[d]<b;)d++;return d},bisectRight:function(a,b,c){var d=a.length-1;if(c)for(;d>0&&a[d][c]>b;)d--;else for(;d>0&&a[d]>b;)d--;return d},clamp:function(a,b,c){return b>a?b:a>c?c:a},isFn:function(a){return"function"==typeof a},inArray:function(b,c){return a.isFn(c.indexOf)?c.indexOf(b):$.inArray(b,c)},constrainRange:function(b,c,d){var e=c-b;return b=a.clamp(b,0,d),c=a.clamp(b+e,0,d),e>c-b&&(b=a.clamp(c-e,0,d)),{min:b,max:c}},makeAbsolute:function(a){var b=window.location,c=b.pathname;return/^http|^\/\//i.test(a)?a:("/"!==a.charAt(0)&&(c.lastIndexOf("/")!==c.length-1&&(c=c.substring(0,c.lastIndexOf("/")+1)),a=c+a),b.protocol+"//"+b.host+a)},throttle:function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=b.apply(c,d)};return function(){var i=new Date,j=a-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=b.apply(c,d)):e||(e=setTimeout(h,j)),f}},insertCSS:function(a){var b=document.createElement("style"),c=document.createTextNode(a);try{b.setAttribute("type","text/css"),b.appendChild(c)}catch(d){}return document.getElementsByTagName("head")[0].appendChild(b),b},appendCSSRule:function(a,b,c){return a.insertRule?a.insertRule(b+"{"+c+"}",a.cssRules.length):a.addRule(b,c,a.rules.length)},deleteCSSRule:function(a,b){a.deleteRule?a.deleteRule(b):a.removeRule(b)},getSelectedNode:function(){var a,b,c;return window.getSelection?(b=window.getSelection(),b.rangeCount&&(c=b.getRangeAt(0),c.collapsed||(a=b.anchorNode.parentNode))):document.selection&&(a=document.selection.createRange().parentElement()),a},getComputedStyle:function(a){return window.getComputedStyle&&window.getComputedStyle(a)||a.currentStyle},calculatePtSize:function(){var b=document.createElement("div");b.style.position="absolute",b.style.width="10000pt",document.body.appendChild(b);var c=a.getComputedStyle(b).width,d=parseFloat(c)/1e4;return document.body.removeChild(b),d},countInStr:function(a,b){for(var c,d=0;c=a.indexOf(b,c)+1;)d++;return d},template:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp("\\{\\{"+c+"\\}\\}","g"),b[c]));return a},ajax:function(b,c){function d(){a.isFn(c.success)&&c.success.call(g)}function e(){a.isFn(c.fail)&&c.fail.call(g)}c=c||{};var f=c.method||"GET",g=new window.XMLHttpRequest;return!a.isExternalURL(b)||"withCredentials"in g?(g.open(f,b,!0),g.onreadystatechange=function(){4===this.readyState&&(g.onreadystatechange=null,200===this.status?d():e())},g.send()):"XDomainRequest"in window?(g=new window.XDomainRequest,g.open(f,b),g.onerror=e,g.onload=d,g.send()):(g=null,e()),g},isExternalURL:function(a){function b(a){return a.replace(c,"").split("/")[0]}var c=/^(http(s)?|file)+:\/\//;return c.test(a)&&b(location.href)!==b(a)}})}),Crocodoc.addModule("dragger",function(a){"use strict";function b(b){a.broadcast("dragstart"),f={top:e.scrollTop(),left:e.scrollLeft()},g={x:b.clientX,y:b.clientY},h.on("mousemove",c),h.on("mouseup",d),b.preventDefault()}function c(a){e.scrollTop(f.top-(a.clientY-g.y)),e.scrollLeft(f.left-(a.clientX-g.x)),a.preventDefault()}function d(b){a.broadcast("dragend"),h.off("mousemove",c),h.off("mouseup",d),b.preventDefault()}var e,f,g,h=$(window);return{init:function(a){e=$(a),e.on("mousedown",b)},destroy:function(){e.off("mousedown",b),e.off("mousemove",c),h.off("mouseup",d)}}}),Crocodoc.addModule("layout-base",function(a){"use strict";function b(a,b){var c,d,e,f,h=a.state,i="."+a.config.namespace+" ."+g,j=a.config.stylesheet,k=a.state.pages,l=b*a.config.pageScale,o=100/l;for(f=n.csstransform?n.csstransform+":scale("+l+");width:"+o+"%;height:"+o+"%;":n.csszoom?"zoom:"+l:"",h.previousStyleIndex&&m.deleteCSSRule(j,h.previousStyleIndex),h.previousStyleIndex=m.appendCSSRule(j,i,f),c=0,d=k.length;d>c;++c)e=k[c],a.config.pages[c].setCSS({width:e.actualWidth*b,height:e.actualHeight*b,paddingTop:e.paddingTop*b,paddingRight:e.paddingRight*b,paddingBottom:e.paddingBottom*b,paddingLeft:e.paddingLeft*b})}{var c="crocodoc-layout-",d="crocodoc-current-page",e="crocodoc-page-",f=e+"visible",g=e+"overlay",h="padding-",i=h+"top",j=h+"right",k=h+"left",l=h+"bottom",m=a.getService("util"),n=a.getService("support");a.getService("browser")}return{messages:["resize","scroll","scrollend"],onmessage:function(a,b){switch(a){case"resize":this.handleResize(b);break;case"scroll":this.handleScroll(b);break;case"scrollend":this.handleScrollEnd(b)}},init:function(a){this.config=a,this.$el=a.$el,this.$doc=a.$doc,this.$viewport=a.$viewport,this.$pages=a.$pages,this.$pagesWrapper=a.$pagesWrapper,this.numPages=a.numPages,this.layoutClass=c+a.layout,this.$el.addClass(this.layoutClass),this.initState(),this.initZoomLevels(),this.updatePageStates()},initState:function(){var a=this.$viewport[0];this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:a.scrollTop,scrollLeft:a.scrollLeft,viewportDimensions:{clientWidth:a.clientWidth,clientHeight:a.clientHeight,offsetWidth:a.offsetWidth,offsetHeight:a.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$pagesWrapper.add(this.$doc).removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(b){var c,d,e=this.state,f=this.parseZoomValue(b),g=e.zoomState,h=g.zoom;c=this.calculateZoomMode(b,f),f=m.clamp(f,e.minZoom,e.maxZoom),a.broadcast("beforezoom",m.extend({page:e.currentPage,visiblePages:m.extend([],e.visiblePages)},g)),g.prevZoom=h,g.zoom=f,g.zoomMode=c,this.applyZoom(f),g.canZoomIn=this.calculateNextZoomLevel(Crocodoc.ZOOM_IN)!==!1,g.canZoomOut=this.calculateNextZoomLevel(Crocodoc.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),d=b===Crocodoc.ZOOM_AUTO||b===Crocodoc.ZOOM_FIT_WIDTH||b===Crocodoc.ZOOM_FIT_HEIGHT,this.updateScrollPosition(d),this.updatePageStates(),this.updateVisiblePages(!0),a.broadcast("zoom",m.extend({page:e.currentPage,visiblePages:m.extend([],e.visiblePages),isDraggable:this.isDraggable()},g))},isDraggable:function(){var a=this.state;return a.viewportDimensions.clientHeight<a.totalHeight||a.viewportDimensions.clientWidth<a.totalWidth},parseZoomValue:function(a){var b=parseFloat(a),c=this.state,d=c.zoomState,e=d.zoom,f=e;if(b)f=b;else switch(a){case Crocodoc.ZOOM_FIT_WIDTH:case Crocodoc.ZOOM_FIT_HEIGHT:case Crocodoc.ZOOM_AUTO:f=this.calculateZoomValue(a);break;case Crocodoc.ZOOM_IN:case Crocodoc.ZOOM_OUT:f=this.calculateNextZoomLevel(a)||e;break;default:f=e?d.zoomMode?this.calculateZoomValue(d.zoomMode):e:this.calculateZoomValue(this.config.zoom||Crocodoc.ZOOM_AUTO)}return f},calculateZoomMode:function(a,b){switch(b){case this.calculateZoomValue(Crocodoc.ZOOM_AUTO):return"string"!=typeof a||a!==Crocodoc.ZOOM_FIT_WIDTH&&a!==Crocodoc.ZOOM_FIT_HEIGHT?Crocodoc.ZOOM_AUTO:a;case this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH):return Crocodoc.ZOOM_FIT_WIDTH;case this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT):return Crocodoc.ZOOM_FIT_HEIGHT;default:return null}},calculateNextZoomLevel:function(a){var b,c=!1,d=this.state.zoomState.zoom,e=this.zoomLevels.slice(),f=this.calculateZoomValue(Crocodoc.ZOOM_AUTO),g=this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH),h=this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT),i=[g,h];if(f!==g&&f!==h&&i.push(f),e=e.concat(i),e.sort(function(a,b){return a-b}),a===Crocodoc.ZOOM_IN){for(b=0;b<e.length;++b)if(e[b]>d){c=e[b];break}}else if(a===Crocodoc.ZOOM_OUT)for(b=e.length-1;b>=0;--b)if(e[b]<d){c=e[b];break}return c},calculateZoomValue:function(a){var b=this.state,c=parseFloat(a);return c?c:a===Crocodoc.ZOOM_FIT_WIDTH?b.viewportDimensions.clientWidth/b.widestPage.totalActualWidth:a===Crocodoc.ZOOM_FIT_HEIGHT?b.viewportDimensions.clientHeight/b.tallestPage.totalActualHeight:a===Crocodoc.ZOOM_AUTO?this.calculateZoomAutoValue():b.zoomState.zoom},applyZoom:function(a){b(this,a)},scrollTo:function(a){var b=this.state,c=parseInt(a,10);if("string"==typeof a){if(a===Crocodoc.SCROLL_PREVIOUS&&b.currentPage>1)c=this.calculatePreviousPage();else if(a===Crocodoc.SCROLL_NEXT&&b.currentPage<this.numPages)c=this.calculateNextPage();else if(!c)return}else if(!c&&0!==c)return;c=m.clamp(c,1,this.numPages),this.scrollToPage(c)},scrollBy:function(a,b){a=parseInt(a,10)||0,b=parseInt(b,10)||0,this.scrollToOffset(a+this.state.scrollLeft,b+this.state.scrollTop)},scrollToPage:function(a){var b=this.calculateScrollPositionForPage(a);this.scrollToOffset(b.left,b.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(a){var b=m.clamp(a-1,0,this.numPages-1),c=this.state.pages[b];return{top:c.y0,left:c.x0}},calculateVisibleRange:function(){var a=this.state,b=a.scrollTop,c=b+a.viewportDimensions.clientHeight,d=a.scrollLeft,e=d+a.viewportDimensions.clientWidth,f=m.bisectLeft(a.pages,b,"y1"),g=m.bisectRight(a.pages,c,"y0"),h=m.bisectLeft(a.pages,d,"x1"),i=m.bisectRight(a.pages,e,"x0"),j=Math.max(h,f),k=Math.min(i,g);return m.constrainRange(j,k,this.numPages-1)},scrollToOffset:function(a,b){this.$viewport.scrollLeft(a),this.$viewport.scrollTop(b)},setCurrentPage:function(b){var c=this.state;c.currentPage!==b?(c.currentPage=b,this.updateVisiblePages(),a.broadcast("pagefocus",{page:c.currentPage,numPages:this.numPages,visiblePages:m.extend([],c.visiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(a){var b,c,d,e=this.state,g=this.calculateVisibleRange();for(e.visiblePages.length=0,b=0,c=this.$pages.length;c>b;++b)d=this.$pages.eq(b),b<g.min||b>g.max?a&&d.hasClass(f)&&d.removeClass(f):(a&&!d.hasClass(f)&&d.addClass(f),e.visiblePages.push(b+1))},updatePageStates:function(){var a,b,c,d,e,f=this.state,g=(f.zoomState.zoom||1,f.pages),h=f.rows,m=this.$viewport.scrollTop(),n=this.$viewport.scrollLeft(),o=0,p=0,q=0,r=0;for(h.length=f.sumWidths=f.sumHeights=f.totalWidth=f.totalHeight=0,f.widestPage.totalActualWidth=f.tallestPage.totalActualHeight=0,a=0,b=this.$pages.length;b>a;++a)e=this.$pages.eq(a),d=e[0],c=g[a]||{index:a,paddingLeft:parseFloat(e.css(k)),paddingRight:parseFloat(e.css(j)),paddingTop:parseFloat(e.css(i)),paddingBottom:parseFloat(e.css(l))},c.actualWidth||(c.actualWidth=parseFloat(d.getAttribute("data-width"))),c.actualHeight||(c.actualHeight=parseFloat(d.getAttribute("data-height"))),c.totalActualWidth=c.actualWidth+c.paddingLeft+c.paddingRight,c.totalActualHeight=c.actualHeight+c.paddingTop+c.paddingBottom,c.width=d.offsetWidth,c.height=d.offsetHeight,c.x0=d.offsetLeft,c.y0=d.offsetTop,c.x1=c.width+c.x0,c.y1=c.height+c.y0,p&&Math.abs(c.y0-p)<2&&o++,p=c.y1,h[o]||(h[o]=[]),c.totalActualWidth>f.widestPage.totalActualWidth&&(f.widestPage=c),c.totalActualHeight>f.tallestPage.totalActualHeight&&(f.tallestPage=c),f.sumWidths+=c.width,f.sumHeights+=c.height,c.row=o,g[a]=c,h[o].push(a),g[q].x0+g[q].width<c.x0+c.width&&(q=a),g[r].y0+g[r].height<c.y0+c.height&&(r=a);f.totalWidth=g[q].x0+g[q].width,f.totalHeight=g[r].y0+g[r].height,f.scrollTop=m,f.scrollLeft=n,this.setCurrentPage(this.calculateCurrentPage())},initZoomLevels:function(){this.zoomLevels=this.config.zoomLevels||[1],this.state.minZoom=this.config.minZoom||this.zoomLevels[0],this.state.maxZoom=this.config.maxZoom||this.zoomLevels[this.zoomLevels.length-1]},updateCurrentPage:function(){var a=this.calculateCurrentPage();this.setCurrentPage(a)},handleResize:function(a){var b=this.state.zoomState.zoomMode;this.state.viewportDimensions=a,this.setZoom(b)},handleScroll:function(a){this.state.scrollTop=a.scrollTop,this.state.scrollLeft=a.scrollLeft},handleScrollEnd:function(a){this.$pagesWrapper.find("."+d).removeClass(d),this.$pages.eq(this.state.currentPage-1).addClass(d),this.updateVisiblePages(!0),this.handleScroll(a)},updateScrollPosition:function(a){var b,c,d=this.state,e=d.zoomState,f=e.zoom/e.prevZoom;b=d.scrollLeft*f,c=d.scrollTop*f,a!==!0&&(c+=d.viewportDimensions.offsetHeight*(f-1)/2,b+=d.viewportDimensions.offsetWidth*(f-1)/2),this.scrollToOffset(b,c)},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}}}),Crocodoc.addModule("layout-"+Crocodoc.LAYOUT_HORIZONTAL,["layout-base"],function(a,b){"use strict";var c=a.getService("util"),d=a.getService("browser");return c.extend({},b,{calculateZoomAutoValue:function(){var a=this.state,b=this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH),c=this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(b,c):d.mobile?c:Math.min(1,c)},calculateCurrentPage:function(){var a,b,d=this.state,e=d.pages;return a=c.bisectRight(e,d.scrollLeft,"x0"),b=c.bisectRight(e,d.scrollLeft+e[a].width/2,"x0"),1+b},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(a){b.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){b.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a=this.state,b=a.zoomState,c=b.zoom,d=a.sumWidths,e=Math.floor(a.tallestPage.totalActualHeight*c),f=Math.max(d,a.viewportDimensions.clientWidth),g=Math.max(e,a.viewportDimensions.clientHeight);this.$pagesWrapper.css({height:g,lineHeight:g+"px",width:f}),this.$doc.css({height:g,width:f})}})}),Crocodoc.addModule("layout-"+Crocodoc.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+Crocodoc.LAYOUT_PRESENTATION],function(a,b){"use strict";var c=a.getService("util");return c.extend({},b,{init:function(a){a.layout=Crocodoc.LAYOUT_PRESENTATION_TWO_PAGE,this.twoPageMode=!0,b.init.call(this,a)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(a){var c=b.calculateZoomValue.call(this,a);return a===Crocodoc.ZOOM_FIT_WIDTH&&(c/=2),c},scrollToPage:function(a){b.scrollToPage.call(this,a-(a+1)%2)},calculateVisibleRange:function(){var a=this.state.currentPage-1,b=a+1;return c.constrainRange(a,b,this.numPages)}})}),Crocodoc.addModule("layout-"+Crocodoc.LAYOUT_PRESENTATION,["layout-base"],function(a,b){"use strict";var c="crocodoc-page-",d=c+"prev",e=c+"next",f=c+"before",g=c+"after",h=c+"before-buffer",i=c+"after-buffer",j="crocodoc-current-page",k=[e,g,d,f,h,i].join(" "),l=a.getService("util");return l.extend({},b,{init:function(a){b.init.call(this,a),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){b.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(k)},calculateZoomAutoValue:function(){var a=this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH),b=this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT);return Math.min(a,b)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var a=this.state.currentPage-1;return l.constrainRange(a,a,this.numPages)},setCurrentPage:function(a){var c=l.clamp(a-1,0,this.numPages);b.setCurrentPage.call(this,a),this.$pagesWrapper.find("."+j).removeClass(j),this.$pages.eq(this.state.currentPage-1).addClass(j),this.updateVisiblePages(!0),this.updatePageClasses(c)},scrollToPage:function(a){this.setCurrentPage(a)},updateLayout:function(){var a,b,c,d,e,f,g,h=this.state,i=h.zoomState,j=i.zoom,k=this.currentPage||1,l=h.pages[k-1],m=this.twoPageMode?h.pages[k]:l,n=h.viewportDimensions.clientWidth,o=h.viewportDimensions.clientHeight;a=m.actualWidth,b=l.actualWidth+(this.twoPageMode?a:0),c=l.actualHeight,d=Math.floor((b+l.paddingLeft+m.paddingRight)*j),e=Math.floor(l.totalActualHeight*j),f=Math.max(d,n),g=Math.max(e,o),this.$pagesWrapper.add(this.$doc).css({width:f,height:g}),this.updatePageMargins(),f>n||g>o?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var a,b,c,d,e,f,g,h,i,j=this.state,k=j.viewportDimensions.clientWidth,l=j.viewportDimensions.clientHeight;for(a=0,b=this.$pages.length;b>a;++a)d=this.config.pages[a],c=j.pages[a],i=this.twoPageMode?a%2===1?c.paddingRight:c.paddingLeft:c.paddingRight+c.paddingLeft,e=(c.actualWidth+i)*j.zoomState.zoom,f=(c.actualHeight+c.paddingTop+c.paddingBottom)*j.zoomState.zoom,this.twoPageMode?(g=Math.max(0,(k-2*e)/2),a%2===1&&(g+=e)):g=(k-e)/2,h=(l-f)/2,g=Math.max(g,0),h=Math.max(h,0),d.setCSS({marginLeft:g,marginTop:h})},updatePageClasses:function(){var a=this.$pages,b=this.state.currentPage-1,c=b+1,j=b-1,l=20;a.removeClass(k),this.twoPageMode?(c=b+2,j=b-2,a.slice(Math.max(j,0),b).addClass(d),a.slice(c,c+2).addClass(e)):(j>=0&&a.eq(j).addClass(d),c<this.numPages&&a.eq(c).addClass(e)),a.slice(0,b).addClass(f),a.slice(Math.max(0,b-l),b).addClass(h),a.slice(c).addClass(g),a.slice(c,Math.min(this.numPages,c+l)).addClass(i)}})}),Crocodoc.addModule("layout-"+Crocodoc.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+Crocodoc.LAYOUT_VERTICAL],function(a,b){"use strict";var c=a.getService("util");return c.extend({},b,{init:function(a){a.layout=Crocodoc.LAYOUT_VERTICAL_SINGLE_COLUMN,b.init.call(this,a)}})}),Crocodoc.addModule("layout-"+Crocodoc.LAYOUT_VERTICAL,["layout-base"],function(a,b){"use strict";var c=a.getService("util"),d=a.getService("browser");return c.extend({},b,{calculateZoomAutoValue:function(){var a=this.state,b=this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH),c=this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT);return a.widestPage.actualWidth>a.tallestPage.actualHeight?Math.min(1,b,c):d.mobile?b:Math.min(1,b)},calculateCurrentPage:function(){var a,b,d,e=this.state,f=e.pages;return a=c.bisectRight(f,e.scrollTop,"y0"),0>a?1:(b=c.bisectRight(f,e.scrollTop+f[a].height/2,"y0"),d=e.rows[f[b].row],1+d[0])},calculateNextPage:function(){var a=this.state,b=a.pages[a.currentPage-1].row,c=a.rows[b+1];return c&&c[0]+1||a.currentPage},calculatePreviousPage:function(){var a=this.state,b=a.pages[a.currentPage-1].row,c=a.rows[b-1];return c&&c[0]+1||a.currentPage},handleResize:function(a){b.handleResize.call(this,a),this.updateCurrentPage()},handleScroll:function(a){b.handleScroll.call(this,a),this.updateCurrentPage()},updateLayout:function(){var a,b,c,d,e,f=this.state,g=f.zoomState.zoom;a=Math.floor(f.widestPage.totalActualWidth*g),d=Math.max(a,f.viewportDimensions.clientWidth),e=this.$pagesWrapper.height(),this.$pagesWrapper.css({height:"auto",width:d}),e=this.$pagesWrapper.height(),b=a<=f.viewportDimensions.clientWidth?"auto":a,c=e,this.$doc.css({height:c,width:b})}})}),Crocodoc.addModule("lazy-loader",function(a){"use strict";function b(a){a=a||t;var b=v.page-1,c=b-a,d=b+a;return p.constrainRange(c,d,m-1)}function c(){var a;clearTimeout(o),s.length>0?(a=s.shift(),l[a]&&l[a].errorCount<=w?r.loadPage(a,function(){o=setTimeout(c,x)}):c()):e()}function d(){clearTimeout(o),u=!1,o=setTimeout(c,x)}function e(){clearTimeout(o),u=!0}function f(a){s.push(a),u&&d()}function g(){s.length=0,e()}function h(a){var b=l[a];if(b&&b.shouldLoad()){if(j(a))return!0;if(k(a))return!0}return!1}function i(a,b){return j(a,b)?!1:k(a)?!1:!0}function j(a,c){var d=b(c);return a>=d.min&&a<=d.max?!0:!1}function k(a){return p.inArray(a+1,v.visiblePages)>-1}var l,m,n,o,p=a.getService("util"),q=a.getService("browser"),r={},s=[],t=1,u=!0,v={page:1,visiblePages:[1]},w=1,x=q.mobile||q.ielt10?100:50,y=q.mobile||q.ielt10?8:32;return p.extend(r,{messages:["beforezoom","zoom","resize","pagefocus","scroll","scrollend","ready"],onmessage:function(a,b){switch(a){case"ready":case"resize":this.loadNecessaryPages();break;case"beforezoom":this.unloadUnnecessaryPages(2*b.visiblePages.length);break;case"zoom":this.updateLayoutState(b),this.loadNecessaryPages();break;case"scroll":this.cancelAllLoading();break;case"scrollend":this.loadNecessaryPages(),r.unloadUnnecessaryPages(t);break;case"pagefocus":this.updateLayoutState(b),this.cancelAllLoading(),n=setTimeout(function(){r.loadNecessaryPages()},200)}},init:function(a){l=a,m=l.length,t=Math.min(y,m)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(a){v=a},loadNecessaryPages:function(){this.cancelAllLoading(),this.queuePageToLoad(v.page-1),this.loadVisiblePages(),this.loadPagesInRange(t)},loadPagesInRange:function(a){var c,d=v.page-1;if(a>0){for(a=b(a),c=d+1;c<=a.max;++c)this.queuePageToLoad(c);for(c=d-1;c>=a.min;--c)this.queuePageToLoad(c)}},loadVisiblePages:function(){var a,b;for(a=0,b=v.visiblePages.length;b>a;++a)this.queuePageToLoad(v.visiblePages[a]-1)},queuePageToLoad:function(a){h(a)&&(l[a].preload(),f(a))},cancelAllLoading:function(){clearTimeout(n),g()},loadPage:function(a,b){$.when(l[a]&&l[a].load()).fail(function(b){l[a].errorCount=l[a].errorCount||0,l[a].errorCount<w?s.unshift(a):l[a].fail(b),l[a].errorCount++}).always(b)},unloadPage:function(a){var b=l[a];b&&b.unload()},unloadUnnecessaryPages:function(a){var b,c;for(b=0,c=l.length;c>b;++b)i(b,a)&&this.unloadPage(b)}})}),Crocodoc.addModule("page-img",function(a){"use strict";var b,c,d,e=a.getService("browser"),f=!1,g=e.mobile;return{init:function(a,b){c=$(a),d=b.imgSrc+(b.queryString||"")},destroy:function(){c.empty()},preload:function(){},load:function(){var a=$.Deferred();if(b)f||a.resolve();else{var e=new window.Image;f=!0,e.onload=function(){f=!1,a.resolve()},e.onerror=function(){b=null,a.reject({error:"failed to load image"})},e.src=d,b=$(e),c.html(b)}return b.show(),a},unload:function(){f=!1,g?(b.remove(),b=null):b.hide()}}}),Crocodoc.addModule("page-links",function(a){"use strict";function b(a){var b=$("<a>").addClass(e),c=a.bbox[0],f=a.bbox[1],g={};if(b.css({left:c+"pt",top:f+"pt",width:a.bbox[2]-c+"pt",height:a.bbox[3]-f+"pt"}),a.uri){if(!/^http|^mailto/.test(a.uri))return;g.href=encodeURI(a.uri),g.target="_blank"}else a.destination&&(g.href="#page-"+a.destination.pagenum);b.attr(g),b.data("link",a),b.appendTo(d)}function c(b){var c=$(b.target),d=c.data("link");d&&a.broadcast("linkclicked",d),b.preventDefault()}{var d,e="crocodoc-page-link";a.getService("support")}return{init:function(a,b){d=$(a),this.createLinks(b),d.on("click","."+e,c)},destroy:function(){d.empty().off("click")},createLinks:function(a){var c,d;for(c=0,d=a.length;d>c;++c)b(a[c])}}}),Crocodoc.addModule("page-svg",function(a){"use strict";function b(){switch(H){case s:case y:return $("<iframe>");case x:case t:return $("<object>").attr({type:o,data:"data:"+o+";base64,"+window.btoa(r)});case u:return $('<div style="width:100%; height:100%;">');case v:return $("<object>");case w:case z:return $("<img>")}}function c(){h&&0!==h.length||(F=!1,h=b()),0===h.parent().length&&h.appendTo(i)}function d(b){var d;n?b():(d=m+l,A.ajax(d,{success:function(){var e,f,g=l.replace("&","&#38;"),i=this.responseText,m=!1;return i?(e=A.countInStr(i,'xlink:href="data:image'),e>100&&(i=i.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,""),a.broadcast("asseterror",{error:"Too many data:urls ("+e+")",status:200,resource:d})),i=i.replace(/href="([^"#:]*)"/g,function(a,b){return a.indexOf("css")<0&&(m=!0),'href="'+k+b+g+'"'}),f="<style>"+j.viewerConfig.cssText+"</style>",B.firefox&&!C.isSubpxSupported()&&(f+="<style>text { text-rendering: geometricPrecision; }</style>"),i=i.replace(/<xhtml:link[^>]*>/,f),n=i,B.firefox&&m?(H=x,h.remove(),h=null,c(),h[0].onload=b):b(),void 0):(b({error:"Response was empty",status:200,resource:d}),void 0)},fail:function(){n=null,b({error:this.statusText,status:this.status,resource:d})}}))}function e(){var a,b,c,d,e=h[0].contentDocument,g=h[0].contentWindow||e&&e.defaultView;switch(H){case s:B.ie&&B.version<10&&(n=n.replace(/<xhtml:link.*/,"")),d=p+n,e.open(),e.write(d),e.close(),c=e.getElementsByTagName("svg")[0],n=null;break;case y:return d=p+A.template(q,{encodedScript:window.btoa("("+f+")()")}),e.open(),e.write(d),e.close(),"complete"===e.readyState?(g.loadSVG(n),n=null):g.onload=function(){this.loadSVG(n),n=null},void 0;case t:a=new D,b=a.parseFromString(n,o),c=e.importNode(b.documentElement,!0),e.documentElement.appendChild(c),n=null;break;case x:g.loadSVG(n),c=e.querySelector("svg"),n=null;break;case u:a=new D,b=a.parseFromString(n,o),c=document.importNode(b.documentElement,!0),h.append(c),n=null;break;case v:h.attr({type:o,data:m+l}),c=h[0];break;case w:c=h[0],c.src=m+l;break;case z:c=h[0],c.src=window.btoa?"data:"+o+";base64,"+window.btoa(n):"data:"+o+","+encodeURIComponent(n),n=null}c.setAttribute("width","100%"),c.setAttribute("height","100%")}function f(){window.loadSVG=function(a){var b=new window.DOMParser,c=b.parseFromString(a,"image/svg+xml"),d=document.importNode(c.documentElement,!0);d.setAttribute("width","100%"),d.setAttribute("height","100%"),document.body?document.body.appendChild(d):document.documentElement.appendChild(d)}}function g(b){b?(a.broadcast("asseterror",b),F=!1):(0===h.parent().length&&h.appendTo(i),h.show(),F=!0)}var h,i,j,k,l,m,n,o="image/svg+xml",p="<style>html, body { width:100%; height: 100%; margin: 0; overflow: hidden; }</style>",q='<script type="text/javascript" src="data:text/javascript;base64,{{encodedScript}}"></script>',r='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+f+")()]]></script></svg>",s=1,t=2,u=3,v=4,w=5,x=6,y=7,z=8,A=a.getService("util"),B=a.getService("browser"),C=a.getService("subpx"),D=window.DOMParser,E=!1,F=!1,G=B.mobile||B.ielt10,H=B.ie?z:B.firefox?z:B.safari?y:s;return{init:function(a,b){i=$(a),j=b,k=j.url,m=j.svgSrc,l=j.queryString||"",H=j.viewerConfig.embedStrategy||H},destroy:function(){E=!0,i.empty()},preload:function(){c()},load:function(){var a=$.Deferred();return F?(g(),a.resolve()):(c(),H===v||H===w?(e(),g(),a.resolve()):d(function(b){E||(!b&&h&&0!==h.length&&n?(e(),g(),a.resolve()):(b||(b={error:"unknown",status:0,resource:m+l}),g(b),a.reject(b)))})),a},unload:function(){G?(h.remove(),h=null,F=!1):h.hide()}}}),Crocodoc.addModule("page-text",function(a){"use strict";function b(){return h.viewerConfig.enableTextSelection&&!k.ielt9}function c(a){var b,c;o=!1,n=!0;var e=m.countInStr(a,"<div");return e>j?(d({error:"too many textboxes",status:200,resource:g}),void 0):(a=a.replace(/<link rel="stylesheet".*/,""),b=document.implementation.createHTMLDocument(""),b.getElementsByTagName("body")[0].innerHTML=a,c=document.importNode(b.querySelector("."+i),!0),f.attr("class",c.getAttribute("class")),f.html(c.innerHTML),l.fix(f),void 0)}function d(b){o=!1,n=!0,a.broadcast("asseterror",b)}function e(){n||o||(o=!0,m.ajax(g,{success:function(){q||(this.responseText.length>0?c(this.responseText):d({error:"empty response",status:this.status,resource:g}))
},fail:function(){q||d({error:this.statusText,status:this.status,resource:g})}}))}var f,g,h,i="crocodoc-page-text",j=256,k=a.getService("browser"),l=(a.getService("support"),a.getService("subpx")),m=a.getService("util"),n=!1,o=!1,p=!1,q=!1;return{init:function(a,b){f=$(a),h=b,g=h.textSrc+h.queryString},destroy:function(){q=!0,f.empty()},load:function(){b()&&(p=!0,e())},enable:function(){p=!0,f.css("display","")},disable:function(){p=!1,f.css("display","none")}}}),Crocodoc.addModule("page",function(a){"use strict";var b,c,d,e,f,g,h,i,j="crocodoc-page-",k=j+"inner",l=j+"loading",m=j+"error",n=j+"text",o=j+"svg",p=j+"links",q=a.getService("support"),r=a.getService("util"),s=!1;return{errorCount:0,messages:["pageavailable","textenabledchange","pagefocus"],onmessage:function(a,b){switch(a){case"pageavailable":(b.page===g+1||b.upto>g)&&i===Crocodoc.PAGE_STATUS_CONVERTING&&(i=Crocodoc.PAGE_STATUS_NOT_LOADED,this.loadIfNecessary());break;case"textenabledchange":b.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":h=f===b.page||r.inArray(f,b.visiblePages)>-1}},init:function(h,j){var l,m,r,s;b=h,r=b.find("."+k),m=r.find("."+o),l=r.find("."+n),s=r.find("."+p),j.url=j.url||"",c=a.createModuleInstance("page-text"),d=q.svg?a.createModuleInstance("page-svg"):a.createModuleInstance("page-img"),c.init(l,j),d.init(m,j),j.enableLinks&&j.links.length&&(e=a.createModuleInstance("page-links"),e.init(s,j.links)),i=j.status||Crocodoc.PAGE_STATUS_NOT_LOADED,g=j.index,f=g+1,this.config=j},destroy:function(){this.unload()},shouldLoad:function(){return i===Crocodoc.PAGE_STATUS_NOT_LOADED||i===Crocodoc.PAGE_STATUS_CONVERTING},preload:function(){i===Crocodoc.PAGE_STATUS_NOT_LOADED&&d.preload()},load:function(){var e=this;return b.removeClass(m),s=!0,this.shouldLoad()&&i!==Crocodoc.PAGE_STATUS_CONVERTING?(i=Crocodoc.PAGE_STATUS_LOADING,$.when(d.load(),c.load()).done(function(){s?(i=Crocodoc.PAGE_STATUS_LOADED,b.removeClass(l),a.broadcast("pageload",{page:f})):e.unload()}).fail(function(){i=Crocodoc.PAGE_STATUS_NOT_LOADED,b.removeClass(l)})):$.when()},fail:function(c){i=Crocodoc.PAGE_STATUS_ERROR,b.addClass(m),a.broadcast("pagefail",{page:g+1,error:c})},loadIfNecessary:function(){s&&this.load()},unload:function(){s=!1,i===Crocodoc.PAGE_STATUS_LOADED&&(d.unload(),i=Crocodoc.PAGE_STATUS_NOT_LOADED,b.addClass(l),b.removeClass(m),a.broadcast("pageunload",{page:f}))},setCSS:function(a){b.css(a)},enableTextSelection:function(){h&&c.load(),c.enable()},disableTextSelection:function(){c.disable()}}}),Crocodoc.addModule("resizer",function(a){"use strict";function b(){a.broadcast("resize",{width:h,height:i,clientWidth:f,clientHeight:g,offsetWidth:h,offsetHeight:i})}function c(){d(),j=k.requestAnimationFrame(c,e)}function d(){var a=e.offsetHeight,c=e.offsetWidth;a&&(a!==i||c!==h)&&(i=a,h=c,g=e.clientHeight,f=e.clientWidth,b())}var e,f,g,h,i,j,k=a.getService("support"),l=["webkit"," moz"," ms"," ",""].join("fullscreenchange");return{messages:["ready"],onmessage:function(a){"ready"===a&&c()},init:function(a){e=$(a).get(0),$(document).on(l,b)},destroy:function(){$(document).off(l,b),k.cancelAnimationFrame(j)}}}),Crocodoc.addModule("scroller",function(a){"use strict";function b(){r=!0,s=!1,t=!1,f()}function c(){t=!0,f()}function d(){r=!1,s=!0,u=(new Date).getTime(),t&&e()}function e(){return clearTimeout(j),null===v&&(v=(new Date).getTime()),(new Date).getTime()-v>m?(g(),void 0):(w(),j=setTimeout(e,n),void 0)}function f(){q||(q=!0,a.broadcast("scrollstart",h())),clearTimeout(j),j=setTimeout(g,p),w()}function g(){q=!1,v=null,clearTimeout(j),a.broadcast("scrollend",h())}function h(){return{scrollTop:i.scrollTop(),scrollLeft:i.scrollLeft()}}var i,j,k=a.getService("util"),l=a.getService("browser"),m=3e3,n=30,o=200,p=l.mobile?500:250,q=!1,r=!1,s=!1,t=!1,u=0,v=null,w=k.throttle(o,function(){a.broadcast("scroll",h())});return{init:function(a){i=$(a),i.on("scroll",f),i.on("touchstart",b),i.on("touchmove",c),i.on("touchend",d)},destroy:function(){clearTimeout(j),i.off("scroll",f),i.off("touchstart",b),i.off("touchmove",c),i.off("touchend",d)}}}),Crocodoc.addModule("viewer-api",function(a){"use strict";function b(){q.attr(z,ab.metadata.version||"0.0.0"),Y.mobile&&q.addClass(L),Y.ielt9&&q.addClass(M),Z.svg&&q.addClass(N)}function c(){var a=ab.metadata;ab.numPages=a.numpages,ab.pageStart?ab.pageStart<0&&(ab.pageStart=a.numpages+ab.pageStart):ab.pageStart=1,ab.pageStart=X.clamp(ab.pageStart,1,a.numpages),ab.pageEnd?ab.pageEnd<0&&(ab.pageEnd=a.numpages+ab.pageEnd):ab.pageEnd=a.numpages,ab.pageEnd=X.clamp(ab.pageEnd,ab.pageStart,a.numpages),ab.numPages=ab.pageEnd-ab.pageStart+1}function d(){ab.$viewport=$('<div tabindex="-1">').addClass(D),ab.$doc=$("<div>").addClass(B),ab.$pagesWrapper=$("<div>").addClass(C),ab.$doc.append(ab.$pagesWrapper),ab.$viewport.append(ab.$doc),q.html(ab.$viewport)}function e(){var a,b,c,d,e,f,g,h,i=X.calculatePtSize(),j=ab.metadata.dimensions,k="";for(ab.pageScale=W/(j.width*i),c=ab.zoomLevels[ab.zoomLevels.length-1],d=3/ab.pageScale;d>c;)c+=c/2,ab.zoomLevels.push(c);for(j.exceptions=j.exceptions||{},a=ab.pageStart-1;a<ab.pageEnd;a++)b=a+1,b in j.exceptions?(e=j.exceptions[b].width,f=j.exceptions[b].height):(e=j.width,f=j.height),g=e*i,h=f*i,g*=ab.pageScale,h*=ab.pageScale,k+=X.template(V,{w:g,h:h});ab.$pages=$(k).appendTo(ab.$pagesWrapper)}function f(){b(),e(),g(),i(),t=a.createModuleInstance("lazy-loader"),t.init(ab.pages),v=a.createModuleInstance("scroller"),v.init(ab.$viewport),w=a.createModuleInstance("resizer"),w.init(ab.$viewport),(!ab.enableLinks||Y.ielt9)&&_.disableLinks(),q.removeClass(F),_.setLayout(ab.layout),a.broadcast("ready",{page:ab.page||1,numPages:ab.numPages})}function g(){var b,c,d,e,f,g,i=[],j=ab.pageStart-1,k=ab.pageEnd,l=X.makeAbsolute(ab.url),m=ab.conversionIsComplete?Crocodoc.PAGE_STATUS_NOT_LOADED:Crocodoc.PAGE_STATUS_CONVERTING,n=h();for(b=j;k>b;b++)d=l+X.template(ab.template.svg,{page:b+1}),f=l+X.template(ab.template.html,{page:b+1}),e=l+X.template(ab.template.img,{page:b+1}),g=l+ab.template.css,c=a.createModuleInstance("page"),c.init(ab.$pages.eq(b-j),{index:b,url:l,imgSrc:e,svgSrc:d,textSrc:f,cssSrc:g,status:m,queryString:s,enableLinks:ab.enableLinks,viewerConfig:ab,links:n[b],pageScale:ab.pageScale}),i.push(c);ab.pages=i}function h(){var a,b,c,d=ab.metadata.links||[],e=[];for(a=0,b=ab.metadata.numpages;b>a;++a)e[a]=[];for(a=0,b=d.length;b>a;++a)c=d[a],e[c.pagenum-1].push(c);return e}function i(){$(document).on("mouseup",k)}function j(a){a.uri?window.open(a.uri):a.destination&&_.scrollTo(a.destination.pagenum)}function k(){o()}function l(b){function d(c){a.broadcast("asseterror",c),b?l(!1).then(function(){f.resolve()}).fail(function(a){f.reject(a)}):f.reject(c)}var e=X.makeAbsolute(ab.url)+ab.template.json,f=$.Deferred();return X.ajax(e+s,{success:function(){if(!bb){if(ab.metadata=$.parseJSON(this.responseText),!ab.metadata)return d({error:"empty or malformed metadata",status:this.status,resource:e}),void 0;c(),f.resolve()}},fail:function(){bb||d({error:this.statusText,status:this.status,resource:e})}}),f.promise()}function m(b){function c(c){a.broadcast("asseterror",c),b?m(!1).then(function(){e.resolve()}).fail(function(a){e.reject(a)}):e.reject(c)}if(Y.ielt9)return r=X.insertCSS(""),ab.stylesheet=r.styleSheet,$.when();var d=X.makeAbsolute(ab.url)+ab.template.css,e=$.Deferred();return X.ajax(d+s,{success:function(){bb||(ab.cssText=this.responseText,ab.cssText?(r=X.insertCSS(this.responseText),ab.stylesheet=r.sheet,e.resolve()):c({error:"empty stylesheet.css",status:this.status,resource:d}))},fail:function(){bb||c({error:this.statusText,status:this.status,resource:d})}}),e.promise()}function n(){$.when(l(!0),m(!0)).fail(function(b){a.broadcast("fail",b)}).then(f)}function o(){var a=X.getSelectedNode(),b=$(a).closest("."+O);q.find("."+I).removeClass(I),a&&q.has(a)&&b.addClass(I)}function p(b){b?x||(q.addClass(G),x=a.createModuleInstance("dragger"),x.init(ab.$viewport)):x&&(q.removeClass(G),a.removeModuleInstance(x),x=null)}var q,r,s,t,u,v,w,x,y="crocodoc-",z="data-svg-version",A=y+"viewer",B=y+"doc",C=y+"pages",D=y+"viewport",E=y+"zooming",F=y+"loading",G=y+"draggable",H=y+"dragging",I=y+"text-selected",J=y+"text-disabled",K=y+"links-disabled",L=y+"mobile",M=y+"ielt9",N=y+"supports-svg",O=y+"page",P=O+"-inner",Q=O+"-svg",R=O+"-text",S=O+"-links",T=O+"-overlay",U=O+"-loading",V='<div class="'+O+" "+U+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+P+'"><div class="'+Q+'"></div><div class="'+T+'"><div class="'+R+'"></div><div class="'+S+'"></div></div></div></div>',W=1024,X=a.getService("util"),Y=a.getService("browser"),Z=a.getService("support"),_=new Crocodoc.EventTarget,ab={template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},pageStart:null,pageEnd:null,conversionIsComplete:!0,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]},bb=!1;return X.extend(_,{messages:["asseterror","destroy","dragend","dragstart","fail","linkclicked","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(a,b){switch(a){case"linkclicked":j(b);break;case"zoom":b.zoom*=ab.pageScale,b.prevZoom*=ab.pageScale,ab.enableDragging&&p(b.isDraggable),this.fire(a,b);break;case"dragstart":q.hasClass(H)||q.addClass(H),this.fire(a,b);break;case"dragend":q.hasClass(H)&&q.removeClass(H),this.fire(a,b);break;default:this.fire(a,b)}},init:function(a,b){if(ab=X.extend(!0,ab,Crocodoc.Viewer.defaults,b),ab.queryParams&&(s="string"==typeof ab.queryParams?ab.queryParams.replace(/^\?/,""):$.param(ab.queryParams)),s=s?"?"+s:"",ab.$el=q=$(a),0===q.length)throw new Error("Invalid container element");q.addClass(A),ab.namespace=A+"-"+(""+Math.random()).substr(2),q.addClass(ab.namespace),d()},destroy:function(){var b,c=function(){};$(document).off("mouseup",k),q.empty().removeClass(function(a,b){var c=b.match(new RegExp("crocodoc\\S+","g"));return c&&c.join(" ")}),$(r).remove();for(b in _)_.hasOwnProperty(b)&&X.isFn(_[b])&&(_[b]=c);bb=!0,a.broadcast("destroy"),a.destroy()},load:function(){return ab.url?(/\/$/.test(ab.url)||(ab.url+="/"),q.addClass(F),n(),void 0):(a.broadcast("fail",{error:"no URL given for assets"}),void 0)},zoom:function(a){var b=parseFloat(a);b&&(a=b/(ab.pageScale||1)),q.addClass(E),u.setZoom(a),q.removeClass(E)},scrollTo:function(a){u.scrollTo(a)},scrollBy:function(a,b){u.scrollBy(a,b)},setLayout:function(b){var c=ab.page,d=ab.zoom||1;if(u){if(b===ab.layout)return;c=u.state.currentPage,d=u.state.zoomState,a.removeModuleInstance(u)}if(ab.layout=b,u=a.createModuleInstance("layout-"+b),!u)throw new Error("Invalid layout "+b);u.init(ab),u.setZoom(d.zoomMode||d.zoom||d),u.scrollTo(c)},enableTextSelection:function(){ab.enableTextSelection||(q.removeClass(J),ab.enableTextSelection=!0,a.broadcast("textenabledchange",{enabled:!0}))},disableTextSelection:function(){ab.enableTextSelection&&(q.addClass(J),ab.enableTextSelection=!1,a.broadcast("textenabledchange",{enabled:!1}))},enableLinks:function(){q.removeClass(K)},disableLinks:function(){q.addClass(K)},setPageAvailable:function(b){a.broadcast("pageavailable",{page:b})},setPagesAvailableUpTo:function(b){a.broadcast("pageavailable",{upto:b})},focus:function(){ab.$viewport.focus()}})});
