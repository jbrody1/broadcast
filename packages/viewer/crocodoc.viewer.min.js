Crocodoc=function(e){var t=function(){"use strict";function e(t,n,i){var o;for(i=i||t,o=0;o<n.length;++o){if(t===n[o])throw new Error("Circular dependency detected: "+i+"->"+n[o]);a[n[o]]&&e(t,a[n[o]].mixins,i+"->"+n[o])}}var a={},n={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",components:a,utilities:n,createViewer:function(e,a){return new t.Viewer(e,a)},addComponent:function(t,n,i){n instanceof Function&&(i=n,n=[]),e(t,n),a[t]={mixins:n,creator:i}},createComponent:function(e,t){var n=a[e];if(n){for(var i=[],o=0;o<n.mixins.length;++o)i.push(this.createComponent(n.mixins[o],t));return i.unshift(t),n.creator.apply(n.creator,i)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addUtility:function(e,t){n[e]={creator:t,instance:null}},getUtility:function(e){var t=n[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){"use strict";t.Scope=function e(a){var n=t.getUtility("common"),i=[];this.createComponent=function(e){var a=t.createComponent(e,this);return a&&(a.componentName=e,i.push(a)),a},this.destroyComponent=function(e){var t,a;for(t=0,a=i.length;a>t;++t)if(e===i[t]){"function"==typeof e.destroy&&e.destroy(),i.splice(t,1);break}},this.destroy=function(){var e,t,a;for(e=0,t=i.length;t>e;++e)a=i[e],"function"==typeof a.destroy&&a.destroy();i=[]},this.broadcast=function(e,t){var a,o,s,r;for(a=0,o=i.length;o>a;++a)s=i[a],s&&(r=s.messages||[],-1!==n.inArray(e,r)&&"function"==typeof s.onmessage&&s.onmessage.call(s,e,t))},this.getUtility=function(e){return t.getUtility(e)},this.getConfig=function(){return a}}}(),function(){"use strict";t.EventTarget=function(){this._handlers={}},t.EventTarget.prototype={constructor:t.EventTarget,on:function(e,t){"undefined"==typeof this._handlers[e]&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(e,t){var a,n,i,o={type:e,data:t};if(a=this._handlers[o.type],a instanceof Array)for(a=a.concat(),n=0,i=a.length;i>n;n++)a[n]&&a[n].call(this,o);if(a=this._handlers.all,a instanceof Array)for(a=a.concat(),n=0,i=a.length;i>n;n++)a[n]&&a[n].call(this,o)},off:function(e,t){var a=this._handlers[e],n,i;if(a instanceof Array){if(!t)return void(a.length=0);for(n=0,i=a.length;i>n;n++)if(a[n]===t||a[n].handler===t){a.splice(n,1);break}}},one:function(e,t){var a=this,n=function(i){a.off(e,n),t.call(a,i)};n.handler=t,this.on(e,n)}}}(),function(){"use strict";var a="crocodoc-text-disabled",n="crocodoc-links-disabled",i=0;t.Viewer=function(o,s){function r(e,t){h?m.broadcast(e,t):p.push({name:e,data:t})}function l(){for(var e;p.length;)e=p.shift(),m.broadcast(e.name,e.data)}function c(){h=!0,l()}t.EventTarget.call(this);var u=t.getUtility("common"),d,g=e(o),h=!1,p=[],f=u.extend(!0,{},t.Viewer.defaults,s),m=new t.Scope(f),v=m.createComponent("viewer-base");if(0===g.length)throw new Error("Invalid container element");f.id=++i,f.api=this,f.$el=g,v.init(),this.destroy=function(){m.broadcast("destroy"),m.destroy()},this.load=function(){return f.url?(/\/$/.test(f.url)||(f.url+="/"),v.loadAssets(),void this.one("ready",c)):void m.broadcast("fail",{error:"no URL given for assets"})},this.setLayout=function(e){d=v.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);d&&(t&&(e=t/(f.pageScale||1)),d.setZoom(e))},this.scrollTo=function(e){d&&d.scrollTo(e)},this.scrollBy=function(e,t){d&&d.scrollBy(e,t)},this.focus=function(){d&&d.focus()},this.enableTextSelection=function(){f.enableTextSelection||(g.removeClass(a),f.enableTextSelection=!0,m.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){f.enableTextSelection&&(g.addClass(a),f.enableTextSelection=!1,m.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){f.enableLinks||(g.removeClass(n),f.enableLinks=!0)},this.disableLinks=function(){f.enableLinks&&(g.addClass(n),f.enableLinks=!1)},this.updateLayout=function(){d&&(d.updatePageStates(!0),d.setZoom())},this.setPageAvailable=function(e){r("pageavailable",{page:e})},this.setPagesAvailableUpTo=function(e){r("pageavailable",{upto:e})},this.setAllPagesAvailable=function(){h?m.broadcast("pageavailable",{upto:f.numPages}):f.conversionIsComplete=!0}},t.Viewer.prototype=new t.EventTarget,t.Viewer.prototype.constructor=t.Viewer,t.Viewer.defaults={url:null,layout:t.LAYOUT_VERTICAL,zoom:t.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,queryParams:null,plugins:{},enableDragging:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},pageStart:null,pageEnd:null,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),t.addUtility("ajax",function(e){"use strict";function t(e){var t,a,n;try{t=e.status,a=e.statusText,n=e.responseText}catch(i){t=0,a="",n=null}return{status:t,statusText:a,responseText:n}}var a=e.getUtility("common");return{request:function(e,n){function i(){a.isFn(n.success)&&n.success.call(t(r))}function o(){a.isFn(n.fail)&&n.fail.call(t(r))}n=n||{};var s=n.method||"GET",r=new window.XMLHttpRequest;if(!a.isCrossDomain(e)||"withCredentials"in r)r.open(s,e,!0),r.onreadystatechange=function(){if(4===this.readyState){r.onreadystatechange=null;try{200===this.status?i():o()}catch(e){o()}}},r.send();else if("XDomainRequest"in window){r=new window.XDomainRequest;try{r.open(s,e),r.onload=i,r.onerror=o,r.ontimeout=o,r.onprogress=function(){},r.send()}catch(l){r={status:0,statusText:l.message},o()}}else r={status:0,statusText:"CORS not supported"},o();return r}}}),t.addUtility("browser",function(){"use strict";var e=navigator.userAgent,t={},a,n,i,o,s,r;return a=/iphone|ipod|ipad/i.test(e),n=/android/i.test(e),o=/webos/i.test(e),i=/blackberry/i.test(e),s=/blackberry/i.test(e),r=/MSIE/i.test(e),r&&(t.ie=!0,t.version=parseFloat(/MSIE\s+(\d+\.\d+)/i.exec(e)[1]),t.ielt9=t.version<9,t.ielt10=t.version<10),a&&(t.ios=!0),t.mobile=/mobile/i.test(e)||a||n||i||o||s,t.firefox=/firefox/i.test(e),/safari/i.test(e)&&(t.chrome=/chrome/i.test(e),t.safari=!t.chrome),t}),t.addUtility("common",function(){"use strict";var t={};return t.extend=e.extend,t.each=e.each,t.map=e.map,t.parseJSON=e.parseJSON,e.extend(t,{bisectLeft:function(e,t,a){for(var n,i,o=0,s=e.length;s>o;)i=Math.floor((o+s)/2),n=a?e[i][a]:e[i],t>n?o=i+1:s=i;return o},bisectRight:function(e,t,a){for(var n,i,o=0,s=e.length;s>o;)i=Math.floor((o+s)/2),n=a?e[i][a]:e[i],n>t?s=i:o=i+1;return o},clamp:function(e,t,a){return t>e?t:e>a?a:e},sign:function(e){var t=parseInt(e,10);return t?0>t?-1:1:t},isFn:function(e){return"function"==typeof e},inArray:function(a,n){return t.isFn(n.indexOf)?n.indexOf(a):e.inArray(a,n)},constrainRange:function(e,a,n){var i=a-e;return e=t.clamp(e,0,n),a=t.clamp(e+i,0,n),i>a-e&&(e=t.clamp(a-i,0,n)),{min:e,max:a}},makeAbsolute:function(e){var t=window.location,a=t.pathname;return/^http|^\/\//i.test(e)?e:("/"!==e.charAt(0)&&(a.lastIndexOf("/")!==a.length-1&&(a=a.substring(0,a.lastIndexOf("/")+1)),e=a+e),t.protocol+"//"+t.host+e)},now:function(){return(new Date).getTime()},throttle:function(e,a){function n(){l=t.now(),s=null,r=a.apply(i,o)}var i,o,s,r,l=0;return function c(){var c=t.now(),u=e-(c-l);return i=this,o=arguments,0>=u?(clearTimeout(s),s=null,l=c,r=a.apply(i,o)):s||(s=setTimeout(n,u)),r}},debounce:function(e,a){function n(){var c=t.now()-r;e>c?s=setTimeout(n,e-c):(s=null,l=a.apply(i,o),i=o=null)}var i,o,s,r,l;return function c(){return i=this,o=arguments,r=t.now(),s||(s=setTimeout(n,e)),l}},insertCSS:function(e){var t=document.createElement("style"),a=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(a)}catch(n){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,a){var n;return e.insertRule?e.insertRule(t+"{"+a+"}",e.cssRules.length):(n=e.addRule(t,a,e.rules.length),0>n&&(n=e.rules.length-1),n)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var e,t,a;return window.getSelection?(t=window.getSelection(),t.rangeCount&&(a=t.getRangeAt(0),a.collapsed||(e=t.anchorNode.parentNode))):document.selection&&(e=document.selection.createRange().parentElement()),e},getComputedStyle:function(e){return"getComputedStyle"in window?window.getComputedStyle(e):e.currentStyle},calculatePtSize:function(){var e,a,n=1e4,i=document.createElement("div");return i.style.display="block",i.style.position="absolute",i.style.width=n+"pt",document.body.appendChild(i),e=t.getComputedStyle(i).width,a=parseFloat(e)/n,document.body.removeChild(i),a},countInStr:function(e,t){for(var a=0,n;n=e.indexOf(t,n)+1;)a++;return a},template:function(e,t){var a;for(a in t)t.hasOwnProperty(a)&&(e=e.replace(new RegExp("\\{\\{"+a+"\\}\\}","g"),t[a]));return e},isCrossDomain:function(e){function t(e){return e.replace(a,"").split("/")[0]}var a=/^(http(s)?|file)+:\/\//;return a.test(e)&&t(location.href)!==t(e)}})}),t.addUtility("subpx",function(t){"use strict";function a(){if(!e.support.leadingWhitespace)return!1;var t=e(o.template(i,{size:12.5})).appendTo(document.documentElement).get(0),a=e(t).css("font-size"),n=e(t).width();e(t).remove(),t=e(o.template(i,{size:12.6})).appendTo(document.documentElement).get(0);var s=e(t).css("font-size"),r=e(t).width();if(e(t).remove(),!("ontouchstart"in window)){if(a===s)return!1;if(n===r)return!1}return!0}var n="crocodoc-subpx-fix",i='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",o=t.getUtility("common"),s=a();return{fix:function(t){if(!s&&void 0!==document.body.style.zoom){var a=e("<div>").addClass(n);e(t).children().wrapAll(a)}return t},isSubpxSupported:function(){return s}}}),t.addUtility("support",function(){"use strict";function e(e){var n=document.createElement("div"),i,o,s;if(e in n.style)return e;if(i=e.charAt(0).toUpperCase()+e.substr(1),e in n.style)return e;for(o=0;o<a.length;++o)if(s=a[o]+i,s in n.style)return 0===s.indexOf("ms")&&(s="-"+s),t(s);return!1}function t(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var a=["Moz","Webkit","O","ms"],n,i;return function(){for(var e=0,t=["ms","moz","webkit","o"],a=0;a<t.length&&!n;++a)n=window[t[a]+"RequestAnimationFrame"],i=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];n||(n=function(t){var a=(new Date).getTime(),n=Math.max(0,16-(a-e)),i=window.setTimeout(function(){t(a+n)},n);return e=a+n,i}),i||(i=function(e){clearTimeout(e)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:e("transform"),csstransition:e("transition"),csszoom:e("zoom"),requestAnimationFrame:function(){return n.apply(window,arguments)},cancelAnimationFrame:function(){i.apply(window,arguments)}}}),t.addComponent("dragger",function(t){"use strict";function a(e){o.scrollTop(r.top-(e.clientY-l.y)),o.scrollLeft(r.left-(e.clientX-l.x)),e.preventDefault()}function n(e){t.broadcast("dragend"),s.off("mousemove",a),s.off("mouseup",n),e.preventDefault()}function i(e){t.broadcast("dragstart"),r={top:o.scrollTop(),left:o.scrollLeft()},l={x:e.clientX,y:e.clientY},s.on("mousemove",a),s.on("mouseup",n),e.preventDefault()}var o,s=e(window),r,l;return{init:function(t){o=e(t),o.on("mousedown",i)},destroy:function(){o.off("mousedown",i),o.off("mousemove",a),s.off("mouseup",n)}}}),t.addComponent("layout-base",function(e){"use strict";function a(e,t){var a,n,i,o,s=e.state,r="."+e.config.namespace+" ."+l,c=e.config.stylesheet,u=s.pages,d=t*e.config.pageScale,g=100/d;for(o=f.csstransform?f.csstransform+":scale("+d+");width:"+g+"%;height:"+g+"%;":f.csszoom?"zoom:"+d:"",s.previousStyleIndex&&p.deleteCSSRule(c,s.previousStyleIndex),s.previousStyleIndex=p.appendCSSRule(c,r,o),a=0,n=u.length;n>a;++a)i=u[a],e.$pages.eq(a).css({width:i.actualWidth*t,height:i.actualHeight*t,paddingTop:i.paddingTop*t,paddingRight:i.paddingRight*t,paddingBottom:i.paddingBottom*t,paddingLeft:i.paddingLeft*t})}function n(e,t){if(!t||0===t.length)return 1/0;var a=p.map(t,function(t){return e[t].y1});return Math.max.apply(Math,a)}var i="crocodoc-layout-",o="crocodoc-current-page",s="crocodoc-page-",r=s+"visible",l=s+"overlay",c="padding-",u=c+"top",d=c+"right",g=c+"left",h=c+"bottom",p=e.getUtility("common"),f=e.getUtility("support");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var t=e.getConfig();this.config=t,this.$el=t.$el,this.$doc=t.$doc,this.$viewport=t.$viewport,this.$pages=t.$pages,this.$pagesWrapper=t.$pagesWrapper,this.numPages=t.numPages,this.layoutClass=i+t.layout,this.$el.addClass(this.layoutClass),this.initState(),this.initZoomLevels(),this.updatePageStates()},initState:function(){var e=this.$viewport[0];this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportDimensions:{clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],fullyVisiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$pagesWrapper.add(this.$doc).removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(a){var n=this.state,i=this.parseZoomValue(a),o=n.zoomState,s=o.zoom,r,l;r=this.calculateZoomMode(a,i),i=p.clamp(i,n.minZoom,n.maxZoom),e.broadcast("beforezoom",p.extend({page:n.currentPage,visiblePages:p.extend([],n.visiblePages),fullyVisiblePages:p.extend([],n.fullyVisiblePages)},o)),o.prevZoom=s,o.zoom=i,o.zoomMode=r,this.applyZoom(i),o.canZoomIn=this.calculateNextZoomLevel(t.ZOOM_IN)!==!1,o.canZoomOut=this.calculateNextZoomLevel(t.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),l=a===t.ZOOM_AUTO||a===t.ZOOM_FIT_WIDTH||a===t.ZOOM_FIT_HEIGHT,this.updateScrollPosition(l),this.updatePageStates(),this.updateVisiblePages(!0),e.broadcast("zoom",p.extend({page:n.currentPage,visiblePages:p.extend([],n.visiblePages),fullyVisiblePages:p.extend([],n.fullyVisiblePages),isDraggable:this.isDraggable()},o))},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},parseZoomValue:function(e){var a=parseFloat(e),n=this.state,i=n.zoomState,o=i.zoom,s=o;if(a)s=a;else switch(e){case t.ZOOM_FIT_WIDTH:case t.ZOOM_FIT_HEIGHT:case t.ZOOM_AUTO:s=this.calculateZoomValue(e);break;case t.ZOOM_IN:case t.ZOOM_OUT:s=this.calculateNextZoomLevel(e)||o;break;default:s=o?i.zoomMode?this.calculateZoomValue(i.zoomMode):o:this.calculateZoomValue(this.config.zoom||t.ZOOM_AUTO)}return s},calculateZoomMode:function(e,a){switch(a){case this.calculateZoomValue(t.ZOOM_AUTO):return"string"!=typeof e||e!==t.ZOOM_FIT_WIDTH&&e!==t.ZOOM_FIT_HEIGHT?t.ZOOM_AUTO:e;case this.calculateZoomValue(t.ZOOM_FIT_WIDTH):return t.ZOOM_FIT_WIDTH;case this.calculateZoomValue(t.ZOOM_FIT_HEIGHT):return t.ZOOM_FIT_HEIGHT;default:return null}},calculateNextZoomLevel:function(e){var a,n=!1,i=this.state.zoomState.zoom,o=this.zoomLevels.slice(),s=this.calculateZoomValue(t.ZOOM_AUTO),r=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),l=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT),c=[r,l];if(s!==r&&s!==l&&c.push(s),o=o.concat(c),o.sort(function u(e,t){return e-t}),e===t.ZOOM_IN){for(a=0;a<o.length;++a)if(o[a]>i){n=o[a];break}}else if(e===t.ZOOM_OUT)for(a=o.length-1;a>=0;--a)if(o[a]<i){n=o[a];break}return n},calculateZoomValue:function(e){var a=this.state,n=parseFloat(e);return n?n:e===t.ZOOM_FIT_WIDTH?a.viewportDimensions.clientWidth/a.widestPage.totalActualWidth:e===t.ZOOM_FIT_HEIGHT?a.viewportDimensions.clientHeight/a.tallestPage.totalActualHeight:e===t.ZOOM_AUTO?this.calculateZoomAutoValue():a.zoomState.zoom},applyZoom:function(e){a(this,e)},scrollTo:function(e){var a=this.state,n=parseInt(e,10);if("string"==typeof e){if(e===t.SCROLL_PREVIOUS&&a.currentPage>1)n=this.calculatePreviousPage();else if(e===t.SCROLL_NEXT&&a.currentPage<this.numPages)n=this.calculateNextPage();else if(!n)return}else if(!n&&0!==n)return;n=p.clamp(n,1,this.numPages),this.scrollToPage(n)},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=p.clamp(e-1,0,this.numPages-1),a=this.state.pages[t];return{top:a.y0,left:a.x0}},calculateVisibleRange:function(){var e=this.state,t=e.scrollTop,a=t+e.viewportDimensions.clientHeight,n=e.scrollLeft,i=n+e.viewportDimensions.clientWidth,o=p.bisectLeft(e.pages,t,"y1"),s=p.bisectRight(e.pages,a,"y0")-1,r=p.bisectLeft(e.pages,n,"x1"),l=p.bisectRight(e.pages,i,"x0")-1,c=Math.max(r,o),u=Math.min(l,s);return p.constrainRange(c,u,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.scrollTop,a=t+e.viewportDimensions.clientHeight,n=e.scrollLeft,i=n+e.viewportDimensions.clientWidth,o=p.bisectLeft(e.pages,t,"y0"),s=p.bisectRight(e.pages,a,"y1")-1,r=p.bisectLeft(e.pages,n,"x0"),l=p.bisectRight(e.pages,i,"x1")-1,c=Math.max(r,o),u=Math.min(l,s);return p.constrainRange(c,u,this.numPages-1)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},setCurrentPage:function(t){var a=this.state;a.currentPage!==t?(a.currentPage=t,this.updateVisiblePages(),e.broadcast("pagefocus",{page:a.currentPage,numPages:this.numPages,visiblePages:p.extend([],a.visiblePages),fullyVisiblePages:p.extend([],a.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,a,n,i=this.state,o=this.calculateVisibleRange(),s=this.calculateFullyVisibleRange();for(i.visiblePages.length=0,i.fullyVisiblePages.length=0,t=0,a=this.$pages.length;a>t;++t)n=this.$pages.eq(t),t<o.min||t>o.max?e&&n.hasClass(r)&&n.removeClass(r):(e&&!n.hasClass(r)&&n.addClass(r),i.visiblePages.push(t+1)),t>=s.min&&t<=s.max&&i.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t=this.state,a=t.pages,i=t.rows,o=this.$viewport.scrollTop(),s=this.$viewport.scrollLeft(),r=0,l=0,c=0,p=0,f,m,v,y,T;for(i.length=t.sumWidths=t.sumHeights=t.totalWidth=t.totalHeight=0,t.widestPage.totalActualWidth=t.tallestPage.totalActualHeight=0,f=0,m=this.$pages.length;m>f;++f)T=this.$pages.eq(f),y=T[0],v=a[f],(!v||e)&&(T.css("padding",""),v={index:f,paddingLeft:parseFloat(T.css(g)),paddingRight:parseFloat(T.css(d)),paddingTop:parseFloat(T.css(u)),paddingBottom:parseFloat(T.css(h))}),v.actualWidth||(v.actualWidth=parseFloat(y.getAttribute("data-width"))),v.actualHeight||(v.actualHeight=parseFloat(y.getAttribute("data-height"))),v.totalActualWidth=v.actualWidth+v.paddingLeft+v.paddingRight,v.totalActualHeight=v.actualHeight+v.paddingTop+v.paddingBottom,v.width=y.offsetWidth,v.height=y.offsetHeight,v.x0=y.offsetLeft,v.y0=y.offsetTop,v.x1=v.width+v.x0,v.y1=v.height+v.y0,l&&n(a,i[r])<=v.y0+2&&r++,l=v.y1,i[r]||(i[r]=[]),v.totalActualWidth>t.widestPage.totalActualWidth&&(t.widestPage=v),v.totalActualHeight>t.tallestPage.totalActualHeight&&(t.tallestPage=v),t.sumWidths+=v.width,t.sumHeights+=v.height,v.rowIndex=r,a[f]=v,i[r].push(f),a[c].x0+a[c].width<v.x0+v.width&&(c=f),a[p].y0+a[p].height<v.y0+v.height&&(p=f);t.totalWidth=a[c].x0+a[c].width,t.totalHeight=a[p].y0+a[p].height,t.scrollTop=o,t.scrollLeft=s,this.setCurrentPage(this.calculateCurrentPage())},initZoomLevels:function(){this.zoomLevels=this.config.zoomLevels||[1],this.state.minZoom=this.config.minZoom||this.zoomLevels[0],this.state.maxZoom=this.config.maxZoom||this.zoomLevels[this.zoomLevels.length-1]},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.setZoom(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleScrollEnd:function(e){this.$pagesWrapper.find("."+o).removeClass(o),this.$pages.eq(this.state.currentPage-1).addClass(o),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t=this.state,a=t.zoomState,n=a.zoom/a.prevZoom,i,o;i=t.scrollLeft*n,o=t.scrollTop*n,e!==!0&&(o+=t.viewportDimensions.offsetHeight*(n-1)/2,i+=t.viewportDimensions.offsetWidth*(n-1)/2),this.scrollToOffset(i,o)},focus:function(){this.$viewport.focus()},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}}}),t.addComponent("layout-"+t.LAYOUT_HORIZONTAL,["layout-base"],function(e,a){"use strict";var n=e.getUtility("common"),i=e.getUtility("browser");return n.extend({},a,{calculateZoomAutoValue:function(){var e=this.state,a=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),n=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(a,n):i.mobile?n:Math.min(1,n)},calculateCurrentPage:function(){var e,t,a=this.state,i=a.pages;return e=n.bisectRight(i,a.scrollLeft,"x0")-1,t=n.bisectRight(i,a.scrollLeft+i[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){a.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){a.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,a=t.zoom,n=e.sumWidths,i=Math.floor(e.tallestPage.totalActualHeight*a),o=Math.max(n,e.viewportDimensions.clientWidth),s=Math.max(i,e.viewportDimensions.clientHeight);this.$pagesWrapper.css({height:s,lineHeight:s+"px",width:o}),this.$doc.css({height:s,width:o})}})}),t.addComponent("layout-"+t.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+t.LAYOUT_PRESENTATION],function(e,a){"use strict";var n=e.getUtility("common");return n.extend({},a,{init:function(){var n=e.getConfig();n.layout=t.LAYOUT_PRESENTATION_TWO_PAGE,this.twoPageMode=!0,a.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(e){var n=a.calculateZoomValue.call(this,e);return e===t.ZOOM_FIT_WIDTH&&(n/=2),n},scrollToPage:function(e){a.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return n.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),t.addComponent("layout-"+t.LAYOUT_PRESENTATION,["layout-base"],function(e,a){"use strict";var n="crocodoc-page-",i=n+"prev",o=n+"next",s=n+"before",r=n+"after",l=n+"before-buffer",c=n+"after-buffer",u="crocodoc-current-page",d=[o,r,i,s,l,c].join(" "),g=e.getUtility("common");return g.extend({},a,{init:function(){a.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){a.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(d)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),a=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT);return Math.min(e,a)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return g.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var t=g.clamp(e-1,0,this.numPages);a.setCurrentPage.call(this,e),this.$pagesWrapper.find("."+u).removeClass(u),this.$pages.eq(this.state.currentPage-1).addClass(u),this.updateVisiblePages(!0),this.updatePageClasses(t)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e=this.state,t=e.zoomState,a=t.zoom,n=this.currentPage||1,i=e.pages[n-1],o=this.twoPageMode?e.pages[n]:i,s=e.viewportDimensions.clientWidth,r=e.viewportDimensions.clientHeight,l,c,u,d,g,h,p;l=o.actualWidth,c=i.actualWidth+(this.twoPageMode?l:0),u=i.actualHeight,d=Math.floor((c+i.paddingLeft+o.paddingRight)*a),g=Math.floor(i.totalActualHeight*a),h=Math.max(d,s),p=Math.max(g,r),this.$pagesWrapper.add(this.$doc).css({width:h,height:p}),this.updatePageMargins(),h>s||p>r?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,a,n,i,o,s,r,l,c=this.state,u=c.viewportDimensions.clientWidth,d=c.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;t>e;++e)n=this.$pages.eq(e),a=c.pages[e],l=this.twoPageMode?e%2===1?a.paddingRight:a.paddingLeft:a.paddingRight+a.paddingLeft,i=(a.actualWidth+l)*c.zoomState.zoom,o=(a.actualHeight+a.paddingTop+a.paddingBottom)*c.zoomState.zoom,this.twoPageMode?(s=Math.max(0,(u-2*i)/2),e%2===1&&(s+=i)):s=(u-i)/2,r=(d-o)/2,s=Math.max(s,0),r=Math.max(r,0),n.css({marginLeft:s,marginTop:r})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,a=t+1,n=t-1,u=20;e.removeClass(d),this.twoPageMode?(a=t+2,n=t-2,e.slice(Math.max(n,0),t).addClass(i),e.slice(a,a+2).addClass(o)):(n>=0&&e.eq(n).addClass(i),a<this.numPages&&e.eq(a).addClass(o)),e.slice(0,t).addClass(s),e.slice(Math.max(0,t-u),t).addClass(l),e.slice(a).addClass(r),e.slice(a,Math.min(this.numPages,a+u)).addClass(c)}})}),t.addComponent("layout-"+t.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+t.LAYOUT_VERTICAL],function(e,a){"use strict";var n=e.getUtility("common");return n.extend({},a,{init:function(){var n=e.getConfig();n.layout=t.LAYOUT_VERTICAL_SINGLE_COLUMN,a.init.call(this)}})}),t.addComponent("layout-"+t.LAYOUT_VERTICAL,["layout-base"],function(e,a){"use strict";var n=e.getUtility("common"),i=e.getUtility("browser");return n.extend({},a,{calculateZoomAutoValue:function(){var e=this.state,a=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),n=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,a,n):i.mobile?a:Math.min(1,a)},calculateCurrentPage:function(){var e,t,a,i,o,s=this.state,r=s.pages;return e=n.bisectRight(r,s.scrollTop,"y0")-1,0>e?1:(o=s.scrollTop+r[e].height/2,t=n.bisectRight(r,o,"y0")-1,a=r[t].rowIndex,i=s.rows[a],1+i[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],a=t.rowIndex,n=e.rows[a+1];return n&&n[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],a=t.rowIndex,n=e.rows[a-1];return n&&n[0]+1||e.currentPage},handleResize:function(e){a.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){a.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState.zoom,a,n,i,o,s;a=Math.floor(e.widestPage.totalActualWidth*t),o=Math.max(a,e.viewportDimensions.clientWidth),s=this.$pagesWrapper.height(),this.$pagesWrapper.css({height:"auto",width:o}),s=this.$pagesWrapper.height(),n=a<=e.viewportDimensions.clientWidth?"auto":a,i=s,this.$doc.css({height:i,width:n})}})}),t.addComponent("lazy-loader",function(t){"use strict";function a(e){e=e||w;var t=x.page-1,a=t-e,n=t+e;return h.constrainRange(a,n,v-1)}function n(){var e;clearTimeout(T),b.length>0?(e=b.shift(),m[e]&&m[e].errorCount<=C?f.loadPage(e,function t(e){e===!1?n():T=setTimeout(n,O)}):n()):o()}function i(){clearTimeout(T),P=!1,T=setTimeout(n,O)}function o(){clearTimeout(T),P=!0}function s(e){b.push(e),P&&i()}function r(){b.length=0,o()}function l(e,t){var n=a(t);return e>=n.min&&e<=n.max?!0:!1}function c(e){var t=m[e];if(t){if(l(e))return!0;if(d(e))return!0}return!1}function u(e,t){return l(e,t)?!1:d(e)?!1:!0}function d(e){return h.inArray(e+1,x.visiblePages)>-1}function g(e,t){for(var a=h.sign(t-e);e!==t;)f.queuePageToLoad(e),e+=a;f.queuePageToLoad(e)}var h=t.getUtility("common"),p=t.getUtility("browser"),f={},m,v,y,T,b=[],w=1,P=!0,S=1,x={page:1,visiblePages:[1]},C=1,O=p.mobile||p.ielt10?100:50,A=p.mobile||p.ielt10?8:32;return h.extend(f,{messages:["beforezoom","pageavailable","pagefocus","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t);break;case"zoom":this.handleZoom(t)}},init:function(e){m=e,v=m.length,w=Math.min(A,v)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){S=h.sign(e.page-x.page),x=e},loadNecessaryPages:h.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(x.page-1),this.loadVisiblePages(),this.loadPagesInRange(w)}),loadPagesInRange:function(e){var t=x.page-1;e>0&&(e=a(e),S>=0?(g(t+1,e.max),g(t-1,e.min)):(g(t-1,e.min),g(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=x.visiblePages.length;t>e;++e)this.queuePageToLoad(x.visiblePages[e]-1)},queuePageToLoad:function(e){c(e)&&(m[e].preload(),s(e))},cancelAllLoading:function(){clearTimeout(y),r()},loadPage:function(t,a){e.when(m[t]&&m[t].load()).fail(function n(e){m[t].errorCount=m[t].errorCount||0,m[t].errorCount<C?b.unshift(t):m[t].fail(e),m[t].errorCount++}).always(a)},unloadPage:function(e){var t=m[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,a;for(t=0,a=m.length;a>t;++t)u(t,e)&&this.unloadPage(t)},handlePageAvailable:function(e){var t;if(e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)},handlePageFocus:function(e){this.updateLayoutState(e),this.cancelAllLoading(),y=setTimeout(function(){f.loadNecessaryPages()},200)},handleBeforeZoom:function(e){this.cancelAllLoading(),this.unloadUnnecessaryPages(2*e.visiblePages.length)},handleZoom:function(e){this.updateLayoutState(e),this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){this.loadNecessaryPages(),this.unloadUnnecessaryPages(w)}})}),t.addComponent("page-img",function(t){"use strict";var a=t.getUtility("browser"),n,i,o,s=!1,r=a.mobile;return{init:function(t,a){i=e(t),o=a.imgSrc+(a.queryString||"")},destroy:function(){i.empty()},preload:function(){},load:function(){var t=e.Deferred();if(n)s||t.resolve();else{var a=new window.Image;s=!0,a.onload=function(){s=!1,t.resolve()},a.onerror=function(){n=null,t.reject({error:"failed to load image"})},a.src=o,n=e(a),i.html(n)}return n.show(),t},unload:function(){s=!1,r?(n.remove(),n=null):n&&n.hide()}}}),t.addComponent("page-links",function(t){"use strict";function a(t){var a=e("<a>").addClass(i),n=t.bbox[0],s=t.bbox[1],r={};if(a.css({left:n+"pt",top:s+"pt",width:t.bbox[2]-n+"pt",height:t.bbox[3]-s+"pt"}),t.uri){if(!/^http|^mailto/.test(t.uri))return;r.href=encodeURI(t.uri),r.target="_blank"}else t.destination&&(r.href="#page-"+t.destination.pagenum);a.attr(r),a.data("link",t),a.appendTo(o)}function n(a){var n=e(a.target),i=n.data("link");i&&t.broadcast("linkclicked",i),a.preventDefault()}var i="crocodoc-page-link",o;return{init:function(t,a){o=e(t),this.createLinks(a),o.on("click","."+i,n)},destroy:function(){o.empty().off("click")},createLinks:function(e){var t,n;for(t=0,n=e.length;n>t;++t)a(e[t])}}}),t.addComponent("page-svg",function(t){"use strict";function a(){switch(N){case p:case b:return e("<iframe>");case T:case f:return e("<object>").attr({type:u,data:"data:"+u+";base64,"+window.btoa(h)});case m:return e('<div style="width:100%; height:100%;">');case v:return e("<object>");
case y:case w:return e("<img>")}}function n(){A&&0!==A.length||(H=!1,A=a()),0===A.parent().length&&A.appendTo(_)}function i(e){var t=M.replace("&","&#38;"),a,n;return a=P.countInStr(e,'xlink:href="data:image'),a>c&&(e=e.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),e=e.replace(/href="([^"#:]*)"/g,function(e,a){return'href="'+U+a+t+'"'}),n="<style>"+V.cssText+"</style>",x.firefox&&!C.isSubpxSupported()&&(n+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(/<xhtml:link[^>]*>/,n)}function o(){if(L)return L;var t=Z+M,a=e.Deferred();return A?(E=S.request(t,{success:function(){if(!z){var e=this.responseText;if(!e)return void a.reject({error:"Response was empty",status:200,resource:t});e=i(e),R=e,a.resolve()}},fail:function(){z||(R=null,a.reject({error:this.statusText,status:this.status,resource:t}))}}),L=a.promise()):void a.reject({error:"Error creating SVG element",status:200,resource:t})}function s(){var e,t,a,n,i,o=A[0].contentDocument,s=A[0].contentWindow||o&&o.defaultView;switch(N){case p:x.ie&&x.version<10&&(R=R.replace(/<xhtml:link.*/,"")),n=d+R,o.open(),o.write(n),o.close(),a=o.getElementsByTagName("svg")[0];break;case b:return n=d+P.template(g,{encodedScript:window.btoa("("+r+")()")}),o.open(),o.write(n),o.close(),void("complete"===o.readyState?(s.loadSVG(R),k||(R=null)):s.onload=function(){this.loadSVG(R),k||(R=null)});case f:e=new O,t=e.parseFromString(R,u),a=o.importNode(t.documentElement,!0),o.documentElement.appendChild(a);break;case T:s.loadSVG(R),a=o.querySelector("svg");break;case m:e=new O,t=e.parseFromString(R,u),a=document.importNode(t.documentElement,!0),A.append(a);break;case v:A.attr({type:u,data:Z+M}),a=A[0];break;case y:a=A[0],a.src=Z+M;break;case w:a=A[0],i="data:"+u,a.src=!x.ie&&window.btoa?i+";base64,"+window.btoa(R):i+","+encodeURIComponent(R)}k||(R=null),a.setAttribute("width","100%"),a.setAttribute("height","100%")}function r(){window.loadSVG=function(e){var t=new window.DOMParser,a=t.parseFromString(e,"image/svg+xml"),n=document.importNode(a.documentElement,!0);n.setAttribute("width","100%"),n.setAttribute("height","100%"),document.body?document.body.appendChild(n):document.documentElement.appendChild(n)}}function l(e){e?(t.broadcast("asseterror",e),H=!1,L=null):(0===A.parent().length&&A.appendTo(_),A.show(),H=!0)}var c=100,u="image/svg+xml",d="<style>html, body { width:100%; height: 100%; margin: 0; overflow: hidden; }</style>",g='<script type="text/javascript" src="data:text/javascript;base64,{{encodedScript}}"></script>',h='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+r+")()]]></script></svg>",p=1,f=2,m=3,v=4,y=5,T=6,b=7,w=8,P=t.getUtility("common"),S=t.getUtility("ajax"),x=t.getUtility("browser"),C=t.getUtility("subpx"),O=window.DOMParser,A,_,L,E,I,U,M,Z,R,z=!1,D=!1,H=!1,V=t.getConfig(),k=x.mobile||x.ielt10,N=x.ie?w:x.firefox?w:x.safari?b:p;return{init:function(e,t){_=e,I=t,U=I.url,Z=I.svgSrc,M=I.queryString||"",N=V.embedStrategy||N},destroy:function(){z=!0,this.unload(),_.empty()},preload:function(){n(),o()},load:function(){D=!1;var t=e.Deferred();return H?(l(),t.resolve()):(n(),N===v||N===y?(s(),l(),t.resolve()):o().then(function a(){z||D||(s(),l(),t.resolve())}).fail(function i(e){l(e),t.reject(e)}).always(function r(){E=null})),t},unload:function(){D=!0,E&&E.abort&&(E.abort(),E=null,L=null),k?(A&&(A.remove(),A=null),H=!1):H&&A.hide()}}}),t.addComponent("page-text",function(t){"use strict";function a(){return T.enableTextSelection&&!l.ielt9}function n(e){var t,a;if(e&&!h){h=!0;var n=d.countInStr(e,"<div");n>r||(e=e.replace(/<link rel="stylesheet".*/,""),t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,a=document.importNode(t.querySelector("."+s),!0),p.attr("class",a.getAttribute("class")),p.html(a.innerHTML),c.fix(p))}}function i(e){t.broadcast("asseterror",e)}function o(){if(m)return m;var t=e.Deferred();return f=u.request(v,{success:function(){g||(f=null,0===this.responseText.length&&i({error:"empty response",status:this.status,resource:v}),t.resolve(this.responseText))},fail:function(){g||(f=null,i({error:this.statusText,status:this.status,resource:v}),t.resolve())}}),m=t.promise()}var s="crocodoc-page-text",r=256,l=t.getUtility("browser"),c=t.getUtility("subpx"),u=t.getUtility("ajax"),d=t.getUtility("common"),g=!1,h=!1,p,f,m,v,y,T=t.getConfig();return{init:function(e,t){p=e,y=t,v=y.textSrc+y.queryString},destroy:function(){g=!0,p.empty()},preload:function(){a()&&o()},load:function(){return a()?o().then(n):!1},unload:function(){f&&f.abort&&(f.abort(),f=null,m=null)},enable:function(){p.css("display","")},disable:function(){p.css("display","none")}}}),t.addComponent("page",function(a){"use strict";var n="crocodoc-page-",i=n+"inner",o=n+"loading",s=n+"error",r=n+"text",l=n+"svg",c=n+"links",u=a.getUtility("support"),d=a.getUtility("common"),g,h,p,f,m,v,y,T,b=!1;return{errorCount:0,messages:["pageavailable","textenabledchange","pagefocus","zoom"],onmessage:function(e,a){switch(e){case"pageavailable":(a.page===v+1||a.upto>v)&&T===t.PAGE_STATUS_CONVERTING&&(T=t.PAGE_STATUS_NOT_LOADED);break;case"textenabledchange":a.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":y=m===a.page||d.inArray(m,a.visiblePages)>-1}},init:function(e,n){var o,s,d,y;g=e,d=g.find("."+i),s=d.find("."+l),o=d.find("."+r),y=d.find("."+c),n.url=n.url||"",h=a.createComponent("page-text"),p=a.createComponent(u.svg?"page-svg":"page-img"),h.init(o,n),p.init(s,n),n.enableLinks&&n.links.length&&(f=a.createComponent("page-links"),f.init(y,n.links)),T=n.status||t.PAGE_STATUS_NOT_LOADED,v=n.index,m=v+1,this.config=n},destroy:function(){this.unload()},preload:function(){T===t.PAGE_STATUS_NOT_LOADED&&(p.preload(),h.preload())},load:function(){var n=this,i;return b=!0,T===t.PAGE_STATUS_LOADED||T===t.PAGE_STATUS_LOADING?(i=h.load(),i&&"pending"!==i.state()?!1:i):T===t.PAGE_STATUS_CONVERTING?!1:(g.removeClass(s),T=t.PAGE_STATUS_LOADING,e.when(p.load(),h.load()).done(function r(){b?(T=t.PAGE_STATUS_LOADED,g.removeClass(o),a.broadcast("pageload",{page:m})):n.unload()}).fail(function l(){T=t.PAGE_STATUS_NOT_LOADED,g.removeClass(o)}))},fail:function(e){T=t.PAGE_STATUS_ERROR,g.addClass(s),a.broadcast("pagefail",{page:v+1,error:e})},unload:function(){b=!1,p.unload(),h.unload(),T===t.PAGE_STATUS_LOADED&&(T=t.PAGE_STATUS_NOT_LOADED,g.addClass(o),g.removeClass(s),a.broadcast("pageunload",{page:m}))},enableTextSelection:function(){h.enable(),y&&h.load()},disableTextSelection:function(){h.disable()}}}),t.addComponent("resizer",function(t){"use strict";function a(){t.broadcast("resize",{width:u,height:d,clientWidth:l,clientHeight:c,offsetWidth:u,offsetHeight:d})}function n(){i(),g=o.requestAnimationFrame(n,r)}function i(){var e=r.offsetHeight,t=r.offsetWidth;e&&(e!==d||t!==u)&&(d=e,u=t,c=r.clientHeight,l=r.clientWidth,a())}var o=t.getUtility("support"),s=["webkit"," moz"," ms"," ",""].join("fullscreenchange"),r,l,c,u,d,g;return{messages:["ready"],onmessage:function(e){"ready"===e&&n()},init:function(t){r=e(t).get(0),e(document).on(s,a)},destroy:function(){e(document).off(s,a),o.cancelAnimationFrame(g)}}}),t.addComponent("scroller",function(t){"use strict";function a(){return{scrollTop:f.scrollTop(),scrollLeft:f.scrollLeft()}}function n(){v=!1,P=null,clearTimeout(m),t.broadcast("scrollend",a())}function i(){v||(v=!0,t.broadcast("scrollstart",a())),clearTimeout(m),m=setTimeout(n,p),S()}function o(){y=!0,T=!1,b=!1,i()}function s(){b=!0,i()}function r(){y=!1,T=!0,w=(new Date).getTime(),b&&l()}function l(){return clearTimeout(m),null===P&&(P=(new Date).getTime()),(new Date).getTime()-P>d?void n():(S(),void(m=setTimeout(l,g)))}var c=t.getUtility("common"),u=t.getUtility("browser"),d=3e3,g=30,h=200,p=u.mobile?500:250,f,m,v=!1,y=!1,T=!1,b=!1,w=0,P=null,S=c.throttle(h,function(){t.broadcast("scroll",a())});return{init:function(t){f=e(t),f.on("scroll",i),f.on("touchstart",o),f.on("touchmove",s),f.on("touchend",r)},destroy:function(){clearTimeout(m),f.off("scroll",i),f.off("touchstart",o),f.off("touchmove",s),f.off("touchend",r)}}}),t.addComponent("viewer-base",function(a){"use strict";function n(){q.attr(T,G.metadata.version||"0.0.0"),W.mobile&&q.addClass(_),W.ielt9&&q.addClass(L),$.svg&&q.addClass(E)}function i(){var e=G.metadata;G.numPages=e.numpages,G.pageStart?G.pageStart<0&&(G.pageStart=e.numpages+G.pageStart):G.pageStart=1,G.pageStart=k.clamp(G.pageStart,1,e.numpages),G.pageEnd?G.pageEnd<0&&(G.pageEnd=e.numpages+G.pageEnd):G.pageEnd=e.numpages,G.pageEnd=k.clamp(G.pageEnd,G.pageStart,e.numpages),G.numPages=G.pageEnd-G.pageStart+1}function o(){G.$viewport=e('<div tabindex="-1">').addClass(S),G.$doc=e("<div>").addClass(w),G.$pagesWrapper=e("<div>").addClass(P),G.$doc.append(G.$pagesWrapper),G.$viewport.append(G.$doc),q.html(G.$viewport)}function s(){var t,a,n,i,o,s,r,l,c=k.calculatePtSize(),u=G.metadata.dimensions,d="";for(G.pageScale=V/(u.width*c),n=G.zoomLevels[G.zoomLevels.length-1],i=3/G.pageScale;i>n;)n+=n/2,G.zoomLevels.push(n);for(u.exceptions=u.exceptions||{},t=G.pageStart-1;t<G.pageEnd;t++)a=t+1,a in u.exceptions?(o=u.exceptions[a].width,s=u.exceptions[a].height):(o=u.width,s=u.height),r=o*c,l=s*c,r*=G.pageScale,l*=G.pageScale,d+=k.template(H,{w:r,h:l});G.$pages=e(d).appendTo(G.$pagesWrapper)}function r(){var e,t,n=G.plugins||{};for(e in n)t=a.createComponent("plugin-"+e),t&&k.isFn(t.init)&&t.init(G.plugins[e])}function l(){n(),s(),c(),d(),Y=a.createComponent("lazy-loader"),Y.init(G.pages),X=a.createComponent("scroller"),X.init(G.$viewport),J=a.createComponent("resizer"),J.init(G.$viewport),(!G.enableLinks||W.ielt9)&&F.disableLinks(),q.removeClass(x),F.setLayout(G.layout),a.broadcast("ready",{page:G.page||1,numPages:G.numPages})}function c(){var e,n=[],i,o,s,r,l,c=G.pageStart-1,d=G.pageEnd,g=k.makeAbsolute(G.url),h=G.conversionIsComplete?t.PAGE_STATUS_NOT_LOADED:t.PAGE_STATUS_CONVERTING,p=u();for(e=c;d>e;e++)o=g+k.template(G.template.svg,{page:e+1}),r=g+k.template(G.template.html,{page:e+1}),s=g+k.template(G.template.img,{page:e+1}),l=g+G.template.css,i=a.createComponent("page"),i.init(G.$pages.eq(e-c),{index:e,url:g,imgSrc:s,svgSrc:o,textSrc:r,cssSrc:l,status:h,queryString:G.queryString,enableLinks:G.enableLinks,links:p[e],pageScale:G.pageScale}),n.push(i);G.pages=n}function u(){var e,t,a,n=G.metadata.links||[],i=[];for(e=0,t=G.metadata.numpages;t>e;++e)i[e]=[];for(e=0,t=n.length;t>e;++e)a=n[e],i[a.pagenum-1].push(a);return i}function d(){e(document).on("mouseup",h)}function g(e){e.uri?window.open(e.uri):e.destination&&F.scrollTo(e.destination.pagenum)}function h(){f()}function p(t,n){function i(e){a.broadcast("asseterror",e),n?p(t,!1).then(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}):o.reject(e)}var o=e.Deferred();return N.request(t,{success:function(){return K?void 0:this.responseText?void o.resolve(this.responseText):void i({error:"empty response",status:this.status,resource:t})},fail:function(){K||i({error:this.statusText,status:this.status,resource:t})}}),o.promise()}function f(){var t=k.getSelectedNode(),a=e(t).closest("."+I);q.find("."+A).removeClass(A),t&&q.has(t)&&a.addClass(A)}function m(e){e?Q||(q.addClass(C),Q=a.createComponent("dragger"),Q.init(G.$viewport)):Q&&(q.removeClass(C),a.destroyComponent(Q),Q=null)}function v(){var t;G.queryParams&&(t="string"==typeof G.queryParams?G.queryParams.replace(/^\?/,""):e.param(G.queryParams)),G.queryString=t?"?"+t:""}var y="crocodoc-",T="data-svg-version",b=y+"viewer",w=y+"doc",P=y+"pages",S=y+"viewport",x=y+"loading",C=y+"draggable",O=y+"dragging",A=y+"text-selected",_=y+"mobile",L=y+"ielt9",E=y+"supports-svg",I=y+"page",U=I+"-inner",M=I+"-svg",Z=I+"-text",R=I+"-links",z=I+"-overlay",D=I+"-loading",H='<div class="'+I+" "+D+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+U+'"><div class="'+M+'"></div><div class="'+z+'"><div class="'+Z+'"></div><div class="'+R+'"></div></div></div></div>',V=1024,k=a.getUtility("common"),N=a.getUtility("ajax"),W=a.getUtility("browser"),$=a.getUtility("support"),F,G,q,j,Y,B,X,J,Q,K=!1;return{messages:["asseterror","destroy","dragend","dragstart","fail","linkclicked","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"linkclicked":g(t);break;case"zoom":t.zoom*=G.pageScale,t.prevZoom*=G.pageScale,G.enableDragging&&m(t.isDraggable),F.fire(e,t);break;case"dragstart":q.hasClass(O)||q.addClass(O),F.fire(e,t);break;case"dragend":q.hasClass(O)&&q.removeClass(O),F.fire(e,t);break;default:F.fire(e,t)}},init:function(){G=a.getConfig(),F=G.api,G.namespace=b+"-"+G.id,q=G.$el,q.addClass(b),q.addClass(G.namespace),o(),r()},destroy:function(){e(document).off("mouseup",h),q.empty().removeClass(function(e,t){var a=t.match(new RegExp("crocodoc\\S+","g"));return a&&a.join(" ")}),e(j).remove(),K=!0},setLayout:function(e){var t=G.page,n=G.zoom||1,i;if(B){if(e===G.layout)return B;t=B.state.currentPage,n=B.state.zoomState}if(i=a.createComponent("layout-"+e),!i)throw new Error("Invalid layout "+e);return B&&a.destroyComponent(B),G.layout=e,B=i,B.init(),B.setZoom(n.zoomMode||n.zoom||n),B.scrollTo(t),G.currentLayout=B,B},loadAssets:function(){var t=k.makeAbsolute(G.url),n=t+G.template.css,o=t+G.template.json,s,r;v(),n+=G.queryString,o+=G.queryString,r=p(o,!0),r.then(function c(t){G.metadata=e.parseJSON(t),i()}),W.ielt9?(j=k.insertCSS(""),G.stylesheet=j.styleSheet,s=e.when()):(s=p(n,!0),s.then(function u(e){G.cssText=e,j=k.insertCSS(e),G.stylesheet=j.sheet})),e.when(r,s).fail(function(e){a.broadcast("fail",e)}).then(l)}}}),t}(jQuery);
